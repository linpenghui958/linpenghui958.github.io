(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{406:function(e,s,n){"use strict";n.r(s);var a=n(45),t=Object(a.a)({},(function(){var e=this,s=e.$createElement,n=e._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h3",{attrs:{id:"acme-sh配置ssl-https"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#acme-sh配置ssl-https"}},[e._v("#")]),e._v(" acme.sh配置ssl https")]),e._v(" "),n("hr"),e._v(" "),n("p",[n("strong",[e._v("使用acme.sh从letsencrypt生成免费证书")]),e._v("\n#####1.安装acme.sh\n使用root用户安装")]),e._v(" "),n("blockquote",[n("p",[e._v("curl  https://get.acme.sh | sh")])]),e._v(" "),n("br"),e._v("\n#####2.生产证书\n第一种方式，http 方式需要在你的网站根目录下放置一个文件, 来验证你的域名所有权,完成验证. 然后就可以生成证书了.\n"),n("br"),e._v("\n第二种方式，dns 方式, 在域名上添加一条 txt 解析记录, 验证域名所有权.\n首先登录你的dnspod账号。生产API ID和Key\n例如阿里云\n![Alt text](../img/1522049243596.png)\n在.acme.sh目录下的account.conf添加id和key\n![Alt text](../img/1522049541278.png)\n然后使用\n"),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("acme.sh --issue --dns -dns_xx -d aa.com\n")])])]),n("p",[e._v("xx对应前面保存在account.conf里面的Ali\n然后证书就自动生成了")]),e._v(" "),n("br"),e._v("\n#####copy\n注意, 默认生成的证书都放在安装目录下: ~/.acme.sh/,\n正确的使用方法是使用 --installcert 命令,并指定目标位置, 然后证书文件会被copy到相应的位置, 例如:\n"),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('acme.sh  --installcert  -d  <domain>.com   \\\n--key-file   /etc/nginx/ssl/<domain>.key \\\n--fullchain-file /etc/nginx/ssl/fullchain.cer \\\n--reloadcmd  "service nginx force-reload"\n')])])]),n("p",[e._v("(一个小提醒, 这里用的是 service nginx force-reload, 不是 service nginx reload, 据测试, reload 并不会重新加载证书, 所以用的 force-reload)")]),e._v(" "),n("p",[e._v("Nginx 的配置 ssl_certificate 使用 /etc/nginx/ssl/fullchain.cer ，而非 /etc/nginx/ssl/< domain >.cer ，否则 SSL Labs 的测试会报 Chain issues Incomplete 错误。")]),e._v(" "),n("br"),e._v("\n#####更新acme.sh\n"),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("acme.sh --upgrade\n自动升级\nacme.sh  --upgrade  --auto-upgrade\n关闭自动更新\nacme.sh --upgrade  --auto-upgrade  0\n")])])]),n("br"),e._v(" "),n("p",[e._v("#####出错了咋办")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("acme.sh  --issue  .....  --debug \nacme.sh  --issue  .....  --debug  2\n")])])]),n("br"),e._v("\n#####最后还需要配置nginx才能生效\n"),n("p",[e._v("ps：如果是在阿里云使用，别忘了配置"),n("code",[e._v("安全组")])])])}),[],!1,null,null,null);s.default=t.exports}}]);