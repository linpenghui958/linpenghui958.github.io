<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>useHooks | æ—å°è¾‰çš„blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Just recrod something">
    
    <link rel="preload" href="/assets/css/0.styles.35bcedcf.css" as="style"><link rel="preload" href="/assets/js/app.5d71a1c6.js" as="script"><link rel="preload" href="/assets/js/2.c183a324.js" as="script"><link rel="preload" href="/assets/js/20.90ed0136.js" as="script"><link rel="prefetch" href="/assets/js/10.dcea7a3e.js"><link rel="prefetch" href="/assets/js/11.c7f66434.js"><link rel="prefetch" href="/assets/js/12.de03b6e0.js"><link rel="prefetch" href="/assets/js/13.d9910249.js"><link rel="prefetch" href="/assets/js/14.fafe36af.js"><link rel="prefetch" href="/assets/js/15.03949b40.js"><link rel="prefetch" href="/assets/js/16.05df2604.js"><link rel="prefetch" href="/assets/js/17.fa250f32.js"><link rel="prefetch" href="/assets/js/18.a5e0229d.js"><link rel="prefetch" href="/assets/js/19.4183787b.js"><link rel="prefetch" href="/assets/js/21.cd3b3939.js"><link rel="prefetch" href="/assets/js/22.3050d27e.js"><link rel="prefetch" href="/assets/js/23.d2874efe.js"><link rel="prefetch" href="/assets/js/24.79cca016.js"><link rel="prefetch" href="/assets/js/25.9c5b0a09.js"><link rel="prefetch" href="/assets/js/26.69d37c61.js"><link rel="prefetch" href="/assets/js/27.c6142c6d.js"><link rel="prefetch" href="/assets/js/3.e88f59e6.js"><link rel="prefetch" href="/assets/js/4.24aaf822.js"><link rel="prefetch" href="/assets/js/5.0f611b7f.js"><link rel="prefetch" href="/assets/js/6.148a2419.js"><link rel="prefetch" href="/assets/js/7.1ab69c09.js"><link rel="prefetch" href="/assets/js/8.c66ae691.js"><link rel="prefetch" href="/assets/js/9.4438a384.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35bcedcf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">æ—å°è¾‰çš„blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://www.zhihu.com/column/linxiaohui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  çŸ¥ä¹
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/linpenghui958" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://www.zhihu.com/column/linxiaohui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  çŸ¥ä¹
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/linpenghui958" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flutterç›¸å…³</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue2.0</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>é¢è¯•</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/jsä»£ç è§„èŒƒ.html" class="sidebar-link">Airbnb JavaScript Style Guide()</a></li><li><a href="/js/useHooks.html" aria-current="page" class="active sidebar-link">useHooks</a></li><li><a href="/js/ä½¿ç”¨Nodejså’ŒPuppeteerä»HTMLä¸­å¯¼å‡ºPDF.html" class="sidebar-link">ä½¿ç”¨Nodejså’ŒPuppeteerä»HTMLä¸­å¯¼å‡ºPDF</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å…¶ä»–</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="usehooks"><a href="#usehooks" class="header-anchor">#</a> useHooks</h2> <h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="header-anchor">#</a> ç®€ä»‹</h4> <p>Hooksæ˜¯React 16.8æ–°å¢çš„ä¸€é¡¹ç‰¹æ€§ï¼Œå¯ä»¥è®©ä½ åœ¨ä¸ä½¿ç”¨classçš„æƒ…å†µä¸‹å»ä½¿ç”¨stateå’ŒReactçš„å…¶ä»–åŠŸèƒ½ã€‚è¿™ç¯‡æ–‡ç« æä¾›äº†ç®€å•æ˜“æ‡‚çš„æ¡ˆä¾‹ï¼Œå¸®åŠ©ä½ å»äº†è§£hookså¦‚ä½•ä½¿ç”¨ï¼Œå¹¶ä¸”é¼“åŠ±ä½ åœ¨æ¥ä¸‹æ¥çš„é¡¹ç›®ä¸­å»ä½¿ç”¨å®ƒã€‚ä½†æ˜¯åœ¨æ­¤ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ å·²ç»çœ‹äº†<a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener noreferrer">hookçš„å®˜æ–¹æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="useeventlistener"><a href="#useeventlistener" class="header-anchor">#</a> useEventListener</h4> <p>å¦‚æœä½ å‘ç°è‡ªå·±ä½¿ç”¨<code>useEffect</code>æ·»åŠ äº†è®¸å¤šäº‹ä»¶ç›‘å¬ï¼Œé‚£ä½ å¯èƒ½éœ€è¦è€ƒè™‘å°†è¿™äº›é€»è¾‘å°è£…æˆä¸€ä¸ªé€šç”¨çš„hookã€‚åœ¨ä¸‹é¢çš„ä½¿ç”¨çªé—¨é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå«<code>useEventListener</code>çš„hookï¼Œè¿™ä¸ªhookä¼šæ£€æŸ¥<code>addEventListener</code>æ˜¯å¦è¢«æ”¯æŒã€æ·»åŠ äº‹ä»¶ç›‘å¬å¹¶ä¸”åœ¨cleanupé’©å­ä¸­æ¸…ç©ºç›‘å¬ã€‚ä½ å¯ä»¥åœ¨<a href="https://codesandbox.io/s/z64on3ypm" target="_blank" rel="noopener noreferrer">CodeSandbox demo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ä¸ŠæŸ¥çœ‹åœ¨çº¿å®ä¾‹ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useCallback <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// ä½¿ç”¨</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// ç”¨æ¥å‚¨å­˜é¼ æ ‡ä½ç½®çš„State</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>coords<span class="token punctuation">,</span> setCoords<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// åˆ©ç”¨useCallbackæ¥å¤„ç†å›è°ƒ</span>
  <span class="token comment">// ... è¿™é‡Œä¾èµ–å°†ä¸ä¼šå‘ç”Ÿæ”¹å˜</span>
  <span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ›´æ–°åæ ‡</span>
      <span class="token function">setCoords</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token operator">:</span> clientX<span class="token punctuation">,</span> y<span class="token operator">:</span> clientY <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>setCoords<span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ä½¿ç”¨è‡ªå®šä¹‰çš„hookæ·»åŠ äº‹ä»¶</span>
  <span class="token function">useEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>
      The mouse position <span class="token function">is</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>coords<span class="token punctuation">.</span>x<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>coords<span class="token punctuation">.</span>y<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Hook</span>
<span class="token keyword">function</span> <span class="token function">useEventListener</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> handler<span class="token punctuation">,</span> element <span class="token operator">=</span> global</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// åˆ›å»ºä¸€ä¸ªå‚¨å­˜å¤„ç†æ–¹æ³•çš„ref</span>
  <span class="token keyword">const</span> savedHandler <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// å½“å¤„ç†å‡½æ•°æ”¹å˜çš„æ—¶å€™æ›´æ–°ref.currentçš„æ–¹æ³•</span>
  <span class="token comment">// è¿™æ ·å¯ä»¥ä½¿æˆ‘ä»¬çš„æ€»æ˜¯è·å–åˆ°æœ€æ–°çš„å¤„ç†å‡½æ•°</span>
  <span class="token comment">// å¹¶ä¸”ä¸éœ€è¦åœ¨å®ƒçš„effectä¾èµ–æ•°ç»„ä¸­ä¼ é€’</span>
  <span class="token comment">// å¹¶ä¸”é¿å…æœ‰å¯èƒ½æ¯æ¬¡æ¸²æŸ“é‡æ–°å¼•èµ·effectæ–¹æ³•</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    savedHandler<span class="token punctuation">.</span>current <span class="token operator">=</span> handler<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>handler<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// ç¡®è®¤æ˜¯å¦æ”¯æŒaddEventListener</span>
      <span class="token keyword">const</span> isSupported <span class="token operator">=</span> element <span class="token operator">&amp;&amp;</span> element<span class="token punctuation">.</span>addEventListener<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isSupported<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      
      <span class="token comment">// åˆ›å»ºä¸€ä¸ªè°ƒç”¨å‚¨å­˜åœ¨refä¸­å‡½æ•°çš„äº‹ä»¶ç›‘å¬</span>
      <span class="token keyword">const</span> <span class="token function-variable function">eventListener</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> savedHandler<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment">// æ·»åŠ äº‹ä»¶ç›‘å¬</span>
      element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> eventListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment">// åœ¨cleanupçš„å›è°ƒä¸­ï¼Œæ¸…é™¤äº‹ä»¶ç›‘å¬</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        element<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> eventListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>eventName<span class="token punctuation">,</span> element<span class="token punctuation">]</span> <span class="token comment">// å½“å…ƒç´ æˆ–è€…ç»‘å®šäº‹ä»¶æ”¹å˜æ—¶ï¼Œé‡æ–°è¿è¡Œ</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><a href="https://github.com/donavon/use-event-listener" target="_blank" rel="noopener noreferrer">donavon/use-event-listener<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - è¿™ä¸ªåº“å¯ä»¥ä½œä¸ºè¿™ä¸ªhookçš„åŸå§‹èµ„æºã€‚</p></blockquote> <h4 id="usewhydidyouupdate"><a href="#usewhydidyouupdate" class="header-anchor">#</a> useWhyDidYouUpdate</h4> <p>è¿™ä¸ªhookè®©ä½ æ›´åŠ å®¹æ˜“è§‚å¯Ÿåˆ°æ˜¯å“ªä¸€ä¸ªpropçš„æ”¹å˜å¯¼è‡´äº†ä¸€ä¸ªç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°è¿è¡Œä¸€æ¬¡çš„æˆæœ¬éå¸¸çš„é«˜ï¼Œå¹¶ä¸”ä½ ä¹ŸçŸ¥é“å®ƒä¼šå› ä¸ºå“ªäº›propé€ æˆé‡å¤çš„æ¸²æŸ“ï¼Œä½ å¯ä»¥ä½¿ç”¨<strong>React.memo</strong>è¿™ä¸ªé«˜é˜¶ç»„ä»¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨æ¥ä¸‹æ¥æœ‰ä¸€ä¸ª<strong>Counter</strong>çš„ç»„ä»¶å°†ä¼šä½¿ç”¨è¿™ä¸ªç‰¹æ€§ã€‚åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œå¦‚æœä½ è¿˜åœ¨å¯»æ‰¾ä¸€äº›çœ‹èµ·æ¥ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ï¼Œä½ å¯ä»¥ä½¿ç”¨<strong>useWhyDidYouUpdate</strong>è¿™ä¸ªhookï¼Œå¹¶ä¸”åœ¨ä½ çš„æ§åˆ¶å°æŸ¥çœ‹å“ªä¸€ä¸ªpropåœ¨è¿™æ¬¡æ¸²æŸ“ä¸­å‘ç”Ÿäº†æ”¹å˜å’Œå®ƒæ”¹å˜å‰åçš„å€¼ã€‚Pretty nifty huh?
ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹åœ¨çº¿å®ä¾‹ã€‚<a href="https://codesandbox.io/s/kx83n7201o" target="_blank" rel="noopener noreferrer">CodeSandbox demo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// è®©æˆ‘ä»¬è£…ä½œè¿™ä¸ª&lt;Counter&gt;ç»„ä»¶çš„é‡æ–°æ¸²æŸ“æˆæœ¬å¾ˆé«˜...</span>
<span class="token comment">// ... æˆ‘ä»¬ä½¿ç”¨React.memoå°†å®ƒåŒ…è£¹èµ·æ¥ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶éœ€è¦å¯»æ‰¾æ€§èƒ½é—®é¢˜ :/</span>
<span class="token comment">// å› æ­¤æˆ‘ä»¬æ·»åŠ useWhyDidYouUpdateå¹¶åœ¨æ§åˆ¶å°æŸ¥çœ‹å°†ä¼šå‘ç”Ÿä»€ä¹ˆ</span>
<span class="token keyword">const</span> Counter <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token parameter">props</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">useWhyDidYouUpdate</span><span class="token punctuation">(</span><span class="token string">'Counter'</span><span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>style<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>userId<span class="token punctuation">,</span> setUserId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// æˆ‘ä»¬çš„æ§åˆ¶å°å‘Šè¯‰äº†æˆ‘ä»¬ &lt;Counter&gt; çš„æ ·å¼prop...</span>
  <span class="token comment">// ... åœ¨æ¯ä¸€æ¬¡é‡æ–°æ¸²æŸ“ä¸­çš„æ”¹å˜ï¼Œå³ä½¿æˆ‘ä»¬åªé€šè¿‡æŒ‰é’®æ”¹å˜äº†userIdçš„çŠ¶æ€ ...</span>
  <span class="token comment">// ... è¿™æ˜¯å› ä¸ºæ¯ä¸€æ¬¡é‡æ–°æ¸²æŸ“ä¸­counterStyleéƒ½è¢«é‡æ–°åˆ›å»ºäº†ä¸€é</span>
  <span class="token comment">// æ„Ÿè°¢æˆ‘ä»¬çš„hookè®©æˆ‘ä»¬å‘ç°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”æé†’æˆ‘ä»¬æˆ–è®¸åº”è¯¥æŠŠè¿™ä¸ªå¯¹è±¡ç§»åˆ°componentçš„å¤–éƒ¨</span>
  <span class="token keyword">const</span> counterStyle <span class="token operator">=</span> <span class="token punctuation">{</span>
    fontSize<span class="token operator">:</span> <span class="token string">'3rem'</span><span class="token punctuation">,</span>
    color<span class="token operator">:</span> <span class="token string">'red'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;counter&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Counter count<span class="token operator">=</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span> style<span class="token operator">=</span><span class="token punctuation">{</span>counterStyle<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>Increment<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;user&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://i.pravatar.cc/80?img=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setUserId</span><span class="token punctuation">(</span>userId <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>Switch User<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Hook</span>
<span class="token keyword">function</span> <span class="token function">useWhyDidYouUpdate</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è·å¾—ä¸€ä¸ªå¯å˜çš„kefå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¥å­˜å‚¨propså¹¶ä¸”åœ¨ä¸‹ä¸€æ¬¡hookè¿è¡Œçš„æ—¶å€™è¿›è¡Œæ¯”è¾ƒ</span>
  <span class="token keyword">const</span> previousProps <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>previousProps<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// è·å–æ”¹å˜å‰åæ‰€æœ‰çš„propsçš„keyå€¼</span>
      <span class="token keyword">const</span> allKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>previousProps<span class="token punctuation">.</span>current<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// ä½¿ç”¨è¿™ä¸ªå¯¹è±¡å»è·Ÿè¸ªæ”¹å˜çš„props</span>
      <span class="token keyword">const</span> changesObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">// é€šè¿‡keyå€¼è¿›è¡Œå¾ªç¯</span>
      allKeys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ¤æ–­æ”¹å˜å‰çš„å€¼æ˜¯å¦å’Œå½“å‰çš„ä¸€è‡´</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>previousProps<span class="token punctuation">.</span>current<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> props<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// å°†propæ·»åŠ åˆ°ç”¨æ¥è¿½è¸ªçš„å¯¹è±¡ä¸­</span>
          changesObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token keyword">from</span><span class="token operator">:</span> previousProps<span class="token punctuation">.</span>current<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>
            to<span class="token operator">:</span> props<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// å¦‚æœæ”¹å˜çš„propsä¸ä¸ºç©ºï¼Œåˆ™è¾“å‡ºåˆ°æ§åˆ¶å°</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>changesObj<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[why-did-you-update]'</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> changesObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// æœ€åå°†å½“å‰çš„propså€¼ä¿å­˜åœ¨previousPropsä¸­ï¼Œä»¥ä¾›ä¸‹ä¸€æ¬¡hookè¿›è¡Œçš„æ—¶å€™ä½¿ç”¨</span>
    previousProps<span class="token punctuation">.</span>current <span class="token operator">=</span> props<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="usedarkmode"><a href="#usedarkmode" class="header-anchor">#</a> useDarkMode</h4> <p>è¿™ä¸ªhookåŒ…å«äº†ï¼Œå½“ä½ éœ€è¦åœ¨ä½ çš„ç½‘ç«™æ·»åŠ ä¸€ä¸ªé»‘æš—æ¨¡å¼çš„æ‰€æœ‰çŠ¶æ€é€»è¾‘ã€‚å®ƒåˆ©ç”¨localStorageå»è®°ä½ç”¨æˆ·é€‰æ‹©çš„æ¨¡å¼ã€é»˜è®¤æµè§ˆå™¨æˆ–è€…ç³»ç»Ÿçº§åˆ«è®¾ç½®ä½¿ç”¨<code>prefers-color-schema</code>åª’ä½“æŸ¥è¯¢å’Œç®¡ç†<code>.dark-mode</code>çš„ç±»åå»åœ¨bodyä¸Šåº”ç”¨ä½ è‡ªå·±çš„æ ·å¼ã€‚
è¿™ç¯‡æ–‡ç« åŒæ ·èƒ½å¸®åŠ©ä½ äº†è§£å°†hookç»„åˆèµ·æ¥çš„å¨åŠ›ã€‚å°†stateä¸­çš„çŠ¶æ€åŒæ­¥åˆ°localStorageä¸­ä½¿ç”¨çš„æ˜¯<code>useLocalStorage</code>hookã€‚æ£€æµ‹ç”¨æˆ·çš„é»‘æš—æ¨¡å¼åå¥½ä½¿ç”¨çš„<code>useMeida</code>hookã€‚è¿™ä¸¤ä¸ªhookéƒ½æ˜¯æˆ‘ä»¬åœ¨å…¶ä»–æ¡ˆä¾‹ä¸­åˆ›å»ºçš„ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å°†å®ƒä»¬ç»„åˆèµ·æ¥ï¼Œä½¿ç”¨ç›¸å½“å°‘çš„è¡Œæ•°åˆ›å»ºä¸€ä¸ªéå¸¸æœ‰ç”¨çš„hookã€‚It's almost as if hooks bring the compositional power of React components to stateful logic! ğŸ¤¯</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Usage</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>darkMode<span class="token punctuation">,</span> setDarkMode<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useDarkMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;navbar&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Toggle darkMode<span class="token operator">=</span><span class="token punctuation">{</span>darkMode<span class="token punctuation">}</span> setDarkMode<span class="token operator">=</span><span class="token punctuation">{</span>setDarkMode<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Content <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Hook</span>
<span class="token keyword">function</span> <span class="token function">useDarkMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä½¿ç”¨æˆ‘ä»¬useLocalStorage hookå³ä½¿åœ¨é¡µé¢åˆ·æ–°åä¹Ÿèƒ½ä¿å­˜çŠ¶æ€</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>enabledState<span class="token punctuation">,</span> setEnabledState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useLocalStorage</span><span class="token punctuation">(</span><span class="token string">'dark-mode-enabled'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// æŸ¥çœ‹ç”¨æˆ·æ˜¯å¦å·²ç»ä¸ºé»‘æš—æ¨¡å¼è®¾ç½®äº†ä¸€ä¸ªæµè§ˆå™¨æˆ–ç³»ç»Ÿåå¥½</span>
  <span class="token comment">// usePrefersDarkMode hook ç»„åˆäº† useMedia hook ï¼ˆæŸ¥çœ‹æ¥ä¸‹æ¥çš„ä»£ç ï¼‰</span>
  <span class="token keyword">const</span> prefersDarkMode <span class="token operator">=</span> <span class="token function">usePrefersDarkMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// If enabledState is defined use it, otherwise fallback to prefersDarkMode.</span>
  <span class="token comment">// è¿™å…è®¸ç”¨æˆ·åœ¨æˆ‘ä»¬çš„ç½‘ç«™ä¸Šè¦†ç›–æ‰ç³»ç»Ÿçº§åˆ«çš„è®¾ç½®</span>
  <span class="token keyword">const</span> enabled <span class="token operator">=</span>
    <span class="token keyword">typeof</span> enabledState <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">?</span> enabledState <span class="token operator">:</span> prefersDarkMode<span class="token punctuation">;</span>

  <span class="token comment">// æ”¹å˜é»‘æš—æ¨¡å¼</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> className <span class="token operator">=</span> <span class="token string">'dark-mode'</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> element <span class="token operator">=</span> window<span class="token punctuation">.</span>document<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>enabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        element<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        element<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>enabled<span class="token punctuation">]</span> <span class="token comment">// åªè¦å½“enabledæ”¹å˜æ—¶è°ƒç”¨è¯¥æ–¹æ³•</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// è¿”å›enabledçš„çŠ¶æ€å’Œè®¾ç½®æ–¹æ³•</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>enabled<span class="token punctuation">,</span> setEnabledState<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç»„åˆuseMedia hookå»æ£€æµ‹é»‘æš—æ¨¡å¼çš„åå¥½</span>
<span class="token comment">// useMediaè¢«è®¾è®¡æˆå¯ä»¥æ”¯æŒå¤šç§åª’ä½“æŸ¥è¯¢å¹¶ä¸”è¿”å›æ•°å€¼ã€‚</span>
<span class="token comment">// æ„Ÿè°¢hookçš„ç»„åˆï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸€å—çš„å¤æ‚æ€§éšè—èµ·æ¥</span>
<span class="token comment">// useMediaçš„æ–¹æ³•åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­</span>
<span class="token keyword">function</span> <span class="token function">usePrefersDarkMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">useMedia</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'(prefers-color-scheme: dark)'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><blockquote><p><a href="https://github.com/donavon/use-dark-mode" target="_blank" rel="noopener noreferrer">donavon/use-dark-mode<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - è¿™ä¸ªé’©å­ä¸€ä¸ªæ›´å¯é…ç½®çš„çš„å®ç°ï¼Œå¹¶ä¸”åŒæ­¥äº†ä¸åŒæµè§ˆå™¨tabå’Œå¤„ç†çš„SSRæƒ…å†µã€‚ä¸ºè¿™ç¯‡æ–‡ç« æä¾›äº†å¾ˆå¤šä»£ç å’Œçµæ„Ÿã€‚</p></blockquote> <h4 id="usemedia"><a href="#usemedia" class="header-anchor">#</a> useMedia</h4> <p>è¿™ä¸ªhookè®©ä½ è½»æ˜“å¯ä»¥åœ¨ä½ çš„componenté€»è¾‘é‡Œä½¿ç”¨åª’ä½“æŸ¥è¯¢ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å“ªä¸€ä¸ªåª’ä½“æŸ¥è¯¢åŒ¹é…åˆ°äº†å½“å‰å±å¹•çš„å®½åº¦ï¼Œå¹¶æ¸²æŸ“ä¸åŒçš„åˆ—æ•°ã€‚ç„¶ååˆ†é…å›¾ç‰‡åœ¨åˆ—ä¸­ä¸åŒçš„ä½ç½®ä»¥é™åˆ¶åˆ—çš„é«˜åº¦å·®ï¼ˆæˆ‘ä»¬å¹¶ä¸åƒå¸Œæœ›æŸä¸€åˆ—æ¯”å‰©ä¸‹çš„éƒ½è¦é•¿ï¼‰ã€‚
ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªç›´æ¥è·å–å±å¹•å®½åº¦çš„hookï¼Œä»£æ›¿ä½¿ç”¨åª’ä½“æŸ¥è¯¢ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¼šè®©ä½ æ›´å®¹æ˜“åœ¨JSå’Œä½ çš„Stylesheetå…±äº«åª’ä½“æŸ¥è¯¢ã€‚è¿™é‡ŒæŸ¥çœ‹<a href="https://codesandbox.io/s/6jlmpjq9vw" target="_blank" rel="noopener noreferrer">åœ¨çº¿ç¤ºä¾‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> columnCount <span class="token operator">=</span> <span class="token function">useMedia</span><span class="token punctuation">(</span>
    <span class="token comment">// åª’ä½“æŸ¥è¯¢</span>
    <span class="token punctuation">[</span><span class="token string">'(min-width: 1500px)'</span><span class="token punctuation">,</span> <span class="token string">'(min-width: 1000px)'</span><span class="token punctuation">,</span> <span class="token string">'(min-width: 600px)'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// åˆ—æ•° ï¼ˆè·Ÿä¸Šæ–¹çš„åª’ä½“æŸ¥è¯¢æ•°ç»„æ ¹æ®ä¸‹æ ‡ç›¸å…³ï¼‰</span>
    <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// é»˜è®¤åˆ—æ•°</span>
    <span class="token number">2</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„åˆ—é«˜åº¦æ•°ç»„ï¼Œä»¥0å¡«å……</span>
  <span class="token keyword">let</span> columnHeights <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>columnCount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// åˆ›å»ºä¸€ä¸ªæ•°ç»„ç”¨æ¥å‚¨å­˜æ¯åˆ—çš„å…ƒç´ ï¼Œæ•°ç»„çš„æ¯ä¸€é¡¹ä¸ºä¸€ä¸ªæ•°ç»„</span>
  <span class="token keyword">let</span> columns <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>columnCount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·å–é«˜åº¦æœ€çŸ®çš„é‚£ä¸€é¡¹</span>
    <span class="token keyword">const</span> shortColumnIndex <span class="token operator">=</span> columnHeights<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token operator">...</span>columnHeights<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ·»åŠ item</span>
    columns<span class="token punctuation">[</span>shortColumnIndex<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ›´æ–°é«˜åº¦</span>
    columnHeights<span class="token punctuation">[</span>shortColumnIndex<span class="token punctuation">]</span> <span class="token operator">+=</span> item<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// æ¸²æŸ“æ¯ä¸€åˆ—å’Œå…¶ä¸­çš„å…ƒç´ </span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;App&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;columns is-mobile&quot;</span><span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>columns<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">column</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;column&quot;</span><span class="token operator">&gt;</span>
            <span class="token punctuation">{</span>column<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
              <span class="token operator">&lt;</span>div
                className<span class="token operator">=</span><span class="token string">&quot;image-container&quot;</span>
                style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
                  <span class="token comment">// æ ¹æ®å›¾ç‰‡çš„é•¿å®½æ¯”ä¾‹è°ƒæ•´å›¾ç‰‡å®¹å™¨</span>
                  paddingTop<span class="token operator">:</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>height <span class="token operator">/</span> item<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token string">'%'</span>
                <span class="token punctuation">}</span><span class="token punctuation">}</span>
              <span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>image<span class="token punctuation">}</span> alt<span class="token operator">=</span><span class="token string">&quot;&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Hook</span>
<span class="token keyword">function</span> <span class="token function">useMedia</span><span class="token punctuation">(</span><span class="token parameter">queries<span class="token punctuation">,</span> values<span class="token punctuation">,</span> defaultValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä¸€ä¸ªåŒ…å«äº†æ˜¯å¦åŒ¹é…æ¯ä¸€ä¸ªåª’ä½“æŸ¥è¯¢çš„æ•°ç»„</span>
  <span class="token keyword">const</span> mediaQueryLists <span class="token operator">=</span> queries<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">q</span> <span class="token operator">=&gt;</span> window<span class="token punctuation">.</span><span class="token function">matchMedia</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// æ ¹æ®åŒ¹é…çš„åª’ä½“æŸ¥è¯¢å–å€¼çš„æ–¹æ³•</span>
  <span class="token keyword">const</span> <span class="token function-variable function">getValue</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·å–ç¬¬ä¸€ä¸ªåŒ¹é…çš„åª’ä½“æŸ¥è¯¢çš„ä¸‹æ ‡</span>
    <span class="token keyword">const</span> index <span class="token operator">=</span> mediaQueryLists<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">mql</span> <span class="token operator">=&gt;</span> mql<span class="token punctuation">.</span>matches<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è¿”å›ç›¸å¯¹åº”çš„å€¼æˆ–è€…é»˜è®¤å€¼</span>
    <span class="token keyword">return</span> <span class="token keyword">typeof</span> values<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">?</span> values<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">:</span> defaultValue<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// åŒ¹é…å€¼çš„stateå’Œsetter</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>getValue<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// å›è°ƒæ–¹æ³•</span>
      <span class="token comment">// æ³¨æ„ï¼šé€šè¿‡åœ¨useEffectå¤–å®šä¹‰getValue ...</span>
      <span class="token comment">// ... æˆ‘ä»¬å¯ä»¥ç¡®å®šå®ƒåˆä»hookçš„å‚æ•°ä¼ å…¥çš„æœ€æ–°çš„å€¼ï¼ˆåœ¨è¿™ä¸ªhookçš„å›è°ƒç¬¬ä¸€æ¬¡åœ¨mountçš„æ—¶å€™è¢«åˆ›å»ºï¼‰</span>
      <span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setValue</span><span class="token punctuation">(</span>getValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// ä¸ºä¸Šé¢æ¯ä¸€ä¸ªåª’ä½“æŸ¥è¯¢è®¾ç½®ä¸€ä¸ªç›‘å¬ä½œä¸ºä¸€ä¸ªå›è°ƒ</span>
      mediaQueryLists<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">mql</span> <span class="token operator">=&gt;</span> mql<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// åœ¨cleanupä¸­æ¸…é™¤ç›‘å¬</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> mediaQueryLists<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">mql</span> <span class="token operator">=&gt;</span> mql<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// ç©ºæ•°ç»„ä¿è¯äº†effectåªä¼šåœ¨mountå’Œunmountæ—¶è¿è¡Œ</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><a href="https://gist.github.com/gragland/ed8cac563f5df71d78f4a1fefa8c5633/c769cdc6a658b3925e9e2e204d228400d132965f" target="_blank" rel="noopener noreferrer">useMedia v1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - è¿™ä¸ªå°æ–¹æ³•çš„åŸå§‹æ–¹æ¡ˆï¼Œä½¿ç”¨ä¸€ä¸ªäº‹ä»¶ç›‘å¬æµè§ˆå™¨çš„resizeäº‹ä»¶ï¼Œæ•ˆæœä¹Ÿå¾ˆå¥½ï¼Œä½†æ˜¯åªå¯¹å±å¹•å®½åº¦çš„åª’ä½“æŸ¥è¯¢æœ‰ç”¨ã€‚
<a href="https://codesandbox.io/s/26mjowzpr?from-embed" target="_blank" rel="noopener noreferrer">Masonry Grid<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - useMedia v1çš„æºç ã€‚è¿™ä¸ªdemoåœ¨å›¾ç‰‡æ”¹å˜åˆ—æ•°æ—¶ä½¿ç”¨react-springè¿›è¡ŒåŠ¨ç”»ã€‚</p></blockquote> <h4 id="uselockbodyscroll"><a href="#uselockbodyscroll" class="header-anchor">#</a> useLockBodyScroll</h4> <p>æœ‰æ—¶å€™å½“ä¸€äº›ç‰¹åˆ«çš„ç»„ä»¶åœ¨ä½ ä»¬çš„é¡µé¢ä¸­å±•ç¤ºæ—¶ï¼Œä½ æƒ³è¦é˜»æ­¢ç”¨æˆ·æ»‘åŠ¨ä½ çš„é¡µé¢ï¼ˆæƒ³ä¸€æƒ³modalæ¡†æˆ–è€…ç§»åŠ¨ç«¯çš„å…¨å±èœå•ï¼‰ã€‚å¦‚æœä½ çœ‹åˆ°modalæ¡†ä¸‹çš„å†…å®¹æ»šåŠ¨å°¤å…¶æ˜¯å½“ä½ æ‰“ç®—æ»šåŠ¨modalæ¡†å†…çš„å†…å®¹æ—¶ï¼Œè¿™å¯èƒ½ä¼šè®©äººå¾ˆå›°æƒ‘ã€‚è¿™ä¸ªhookè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚åœ¨ä»»æ„ç»„ä»¶å†…ä½¿ç”¨è¿™ä¸ªhookï¼Œåªæœ‰å½“ç„¶è¿™ä¸ªç»„ä»¶unmountçš„æ—¶å€™ï¼Œé¡µé¢æ‰ä¼šè¢«è§£é”æ»‘åŠ¨ã€‚<a href="https://codesandbox.io/s/yvkol51m81" target="_blank" rel="noopener noreferrer">åœ¨çº¿å®ä¾‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useLayoutEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// ä½¿ç”¨</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// modalæ¡†çš„state</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>modalOpen<span class="token punctuation">,</span> setModalOpen<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setModalOpen</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>Show Modal<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Content <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>modalOpen <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>Modal
          title<span class="token operator">=</span><span class="token string">&quot;Try scrolling&quot;</span>
          content<span class="token operator">=</span><span class="token string">&quot;I bet you you can't! Muahahaha ğŸ˜ˆ&quot;</span>
          onClose<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setModalOpen</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Modal</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> title<span class="token punctuation">,</span> content<span class="token punctuation">,</span> onClose <span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// è°ƒç”¨hooké”å®šbodyæ»šåŠ¨</span>
  <span class="token function">useLockBodyScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;modal-overlay&quot;</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span>onClose<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;modal&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>content<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Hook</span>
<span class="token keyword">function</span> <span class="token function">useLockBodyScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token comment">// è·å–åŸå§‹bodyçš„overflowå€¼</span>
   <span class="token keyword">const</span> originalStyle <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span>overflow<span class="token punctuation">;</span>  
   <span class="token comment">//é˜²æ­¢åœ¨mountçš„è¿‡ç¨‹ä¸­æ»šåŠ¨</span>
   document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> <span class="token string">'hidden'</span><span class="token punctuation">;</span>
   <span class="token comment">// å½“ç»„ä»¶unmountçš„æ—¶å€™è§£é”æ»šåŠ¨</span>
   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> originalStyle<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç©ºæ•°ç»„ä¿è¯äº†effectå‡½æ•°åªä¼šåœ¨mountå’Œunmountçš„æ—¶å€™è¿è¡Œ</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><a href="https://jeremenichelli.io/2019/01/how-hooks-might-shape-design-systems-built-in-react/" target="_blank" rel="noopener noreferrer">How hooks might shape desgin systems built in React<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - ä¸€ç¯‡éå¸¸æ£’ï¼Œå¯å‘äº†è¿™ä¸ªå°æ–¹æ³•çš„æ–‡ç« ã€‚ä»–ä»¬ç‰ˆæœ¬çš„useLockBodyScroll hookæ¥å—ä¸€ä¸ªåˆ‡æ¢å‚æ•°ä»è€Œå¯¹é”å®šçŠ¶æ€æä¾›æ›´å¤šæ§åˆ¶ã€‚</p></blockquote> <h4 id="usetheme"><a href="#usetheme" class="header-anchor">#</a> useTheme</h4> <p>è¿™ä¸ªhookå¸®åŠ©ä½ ç®€å•ä½¿ç”¨CSSå˜é‡åŠ¨æ€çš„æ”¹å˜ä½ çš„appçš„è¡¨ç°ã€‚ä½ åªéœ€è¦ç®€å•çš„åœ¨ä½ æ–‡æ¡£çš„æ ¹å…ƒç´ ä¼ é€’ä¸€ä¸ªï¼Œä½ æƒ³ç”¨æ¥æ›´æ–°å¹¶ä¸”hookæ›´æ–°çš„æ¯ä¸€ä¸ªå˜é‡åŒ…å«é”®å€¼å¯¹çš„CSSå˜é‡ã€‚è¿™åœ¨ä½ æ— æ³•ä½¿ç”¨è¡Œå†…æ ·å¼ï¼ˆæ²¡æœ‰ä¼ªç±»æ”¯æŒï¼‰ä»¥åŠåœ¨ä½ ä»¬çš„ä¸»é¢˜æ ·å¼é‡Œæœ‰å¤ªå¤šæ–¹å¼æ’åˆ—ï¼ˆä¾‹å¦‚ä¸€ä¸ªå¯ä»¥è®©ç”¨æˆ·å®šåˆ¶ä»–ä»¬çš„å¤–è§‚å½¢è±¡çš„appåº”ç”¨ï¼‰çš„æƒ…å†µä¸‹å¾ˆæœ‰ç”¨ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè®¸å¤šcss-in-jsçš„åº“æ”¯æŒåŠ¨æ€çš„æ ·å¼ï¼Œä½†æ˜¯å°è¯•ä¸€ä¸‹ä»…ä»…ä½¿ç”¨CSSå˜é‡å’Œä¸€ä¸ªReact hookæ¥å®Œæˆä¼šæ˜¯éå¸¸æœ‰è¶£çš„ã€‚ä¸‹é¢çš„ä¾‹å­éå¸¸ç®€å•ï¼Œä½†æ˜¯ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ä¸»é¢˜å¯¹è±¡æ˜¯è¢«å­˜å‚¨åœ¨stateä¸­æˆ–è€…ä»æ¥å£è·å–çš„ã€‚ä¸€å®šè¦çœ‹çœ‹è¿™ä¸ªæœ‰è¶£çš„<a href="https://codesandbox.io/s/15mko9187" target="_blank" rel="noopener noreferrer">åœ¨çº¿å®ä¾‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useLayoutEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./styles.scss'</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; https://codesandbox.io/s/15mko9187</span>

<span class="token comment">// Usage</span>
<span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'button-padding'</span><span class="token operator">:</span> <span class="token string">'16px'</span><span class="token punctuation">,</span>
  <span class="token string">'button-font-size'</span><span class="token operator">:</span> <span class="token string">'14px'</span><span class="token punctuation">,</span>
  <span class="token string">'button-border-radius'</span><span class="token operator">:</span> <span class="token string">'4px'</span><span class="token punctuation">,</span>
  <span class="token string">'button-border'</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
  <span class="token string">'button-color'</span><span class="token operator">:</span> <span class="token string">'#FFF'</span><span class="token punctuation">,</span>
  <span class="token string">'button-background'</span><span class="token operator">:</span> <span class="token string">'#6772e5'</span><span class="token punctuation">,</span>
  <span class="token string">'button-hover-border'</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
  <span class="token string">'button-hover-color'</span><span class="token operator">:</span> <span class="token string">'#FFF'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useTheme</span><span class="token punctuation">(</span>theme<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button className<span class="token operator">=</span><span class="token string">&quot;button&quot;</span><span class="token operator">&gt;</span>Button<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Hook</span>
<span class="token keyword">function</span> <span class="token function">useTheme</span><span class="token punctuation">(</span><span class="token parameter">theme</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¾ªç¯è¿™ä¸ªä¸»é¢˜å¯¹è±¡</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> theme<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ›´æ–°æ–‡æ¡£æ ¹å…ƒç´ çš„csså˜é‡</span>
        document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">--</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> theme<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>theme<span class="token punctuation">]</span> <span class="token comment">// åªè¦å½“ä¸»é¢˜å¯¹è±¡å‘è¡Œæ”¹å˜æ—¶æ‰ä¼šå†æ¬¡è¿è¡Œ</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><a href="https://medium.com/geckoboard-under-the-hood/how-we-made-our-product-more-personalized-with-css-variables-and-react-b29298fde608" target="_blank" rel="noopener noreferrer">CSS Variables and React<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> -  ä¸€ç¯‡æ¿€å‘äº†è¿™ä¸ªå°æ–¹æ³•çš„åšæ–‡ï¼Œæ¥è‡ªDan Bahramiã€‚</p></blockquote> <h4 id="usespring"><a href="#usespring" class="header-anchor">#</a> useSpring</h4> <p>è¿™ä¸ªhookæ˜¯react-springçš„ä¸€éƒ¨åˆ†ï¼Œreact-springæ˜¯ä¸€ä¸ªå¯ä»¥è®©ä½ ä½¿ç”¨é«˜æ€§èƒ½ç‰©ç†åŠ¨ç”»çš„åº“ã€‚æˆ‘è¯•å›¾åœ¨è¿™é‡Œé¿å…å¼•å…¥ä¾èµ–å…³ç³»ï¼Œä½†æ˜¯è¿™ä¸€æ¬¡ä¸ºäº†æš´éœ²è¿™ä¸ªéå¸¸æœ‰ç”¨çš„åº“ï¼Œæˆ‘è¦ç ´ä¾‹åšä¸€æ¬¡ã€‚react-springçš„ä¼˜ç‚¹ä¹‹ä¸€å°±æ˜¯å…è®¸å½“ä½ ä½¿ç”¨åŠ¨ç”»æ—¶å®Œå…¨çš„è·³è¿‡React renderçš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™æ ·ç»å¸¸å¯ä»¥å¾—åˆ°å®¢è§‚çš„æ€§èƒ½æå‡ã€‚åœ¨æ¥ä¸‹æ¥çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†æ¸²æŸ“ä¸€è¡Œå¡ç‰‡å¹¶ä¸”æ ¹æ®é¼ æ ‡ç§»è¿‡æ¯ä¸€ä¸ªå¡ç‰‡çš„ä½ç½®åº”ç”¨springåŠ¨ç”»æ•ˆæœã€‚ä¸ºäº†å®ç°è¿™ä¸ªæ•ˆæœï¼Œæˆ‘ä»¬ä½¿ç”¨ç”±ä¸€ç»„å°†è¦å˜æ¢çš„å€¼ç»„æˆçš„æ•°ç»„æ¥è°ƒç”¨useSpring hookã€‚æ¸²æŸ“ä¸€ä¸ªåŠ¨ç”»ç»„ä»¶ï¼ˆç”±react-springå¯¼å‡ºï¼‰ï¼Œç”¨onMouseMoveäº‹ä»¶è·å–é¼ æ ‡çš„ä½ç½®ã€‚ç„¶åè°ƒç”¨setAnimationPropsï¼ˆhookè¿”å›çš„å‡½æ•°ï¼‰å»æ›´æ–°ã€‚ä½ å¯ä»¥é˜…è¯»ä¸‹é¢çš„ä»£ç çš„æ³¨é‡Šï¼Œæˆ–è€…ç›´æ¥æŸ¥çœ‹<a href="https://codesandbox.io/s/6jlvz1j5q3" target="_blank" rel="noopener noreferrer">åœ¨çº¿å®ä¾‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useSpring<span class="token punctuation">,</span> animated <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-spring'</span><span class="token punctuation">;</span>

<span class="token comment">// å±•ç¤ºä¸€è¡Œå¡ç‰‡</span>
<span class="token comment">// Usage of hook is within &lt;Card&gt; component below</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;container&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;row&quot;</span><span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>cards<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">card<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;column&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Card<span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;card-title&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>card<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;card-body&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>card<span class="token punctuation">.</span>description<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>img className<span class="token operator">=</span><span class="token string">&quot;card-image&quot;</span> src<span class="token operator">=</span><span class="token punctuation">{</span>card<span class="token punctuation">.</span>image<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Card<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Card</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªrefæ¥å‚¨å­˜ä»onMouseMoveäº‹ä»¶ä¸­è·å–çš„å…ƒç´ åç§»å€¼å’Œå¤§å°</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// æŒç»­è·Ÿè¸ªè¿™ä¸ªå¡ç‰‡æ˜¯å¦hoverçŠ¶æ€ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ç¡®ä¿è¿™ä¸ªå¡ç‰‡çš„å±‚çº§åœ¨å…¶ä»–åŠ¨ç”»ä¸Šé¢</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isHovered<span class="token punctuation">,</span> setHovered<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// The useSpring hook</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>animatedProps<span class="token punctuation">,</span> setAnimatedProps<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useSpring</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// ç”¨æ¥å‚¨å­˜è¿™äº›å€¼ [rotateX, rotateY, and scale] çš„æ•°ç»„</span>
    <span class="token comment">// æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç»„åˆçš„keyï¼ˆxysï¼‰æ¥ä»£æ›¿åˆ†å¼€çš„keyï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨animatedProps.xys.interpolate()å»æ›´æ–°css transformçš„å€¼</span>
    xys<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// Setup physics</span>
    config<span class="token operator">:</span> <span class="token punctuation">{</span> mass<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> tension<span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span> friction<span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span> precision<span class="token operator">:</span> <span class="token number">0.00001</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>animated<span class="token punctuation">.</span>div
      ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span>
      className<span class="token operator">=</span><span class="token string">&quot;card&quot;</span>
      onMouseEnter<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setHovered</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      onMouseMove<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–é¼ æ ‡Xåæ ‡ç›¸å¯¹å¡ç‰‡çš„ä½ç½®</span>
        <span class="token keyword">const</span> x <span class="token operator">=</span>
          clientX <span class="token operator">-</span>
          <span class="token punctuation">(</span>ref<span class="token punctuation">.</span>current<span class="token punctuation">.</span>offsetLeft <span class="token operator">-</span>
            <span class="token punctuation">(</span>window<span class="token punctuation">.</span>scrollX <span class="token operator">||</span> window<span class="token punctuation">.</span>pageXOffset <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollLeft<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è·å–é¼ æ ‡Yç›¸å¯¹å¡ç‰‡çš„ä½ç½®</span>
        <span class="token keyword">const</span> y <span class="token operator">=</span>
          clientY <span class="token operator">-</span>
          <span class="token punctuation">(</span>ref<span class="token punctuation">.</span>current<span class="token punctuation">.</span>offsetTop <span class="token operator">-</span>
            <span class="token punctuation">(</span>window<span class="token punctuation">.</span>scrollY <span class="token operator">||</span> window<span class="token punctuation">.</span>pageYOffset <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ ¹æ®é¼ æ ‡çš„ä½ç½®å’Œå¡ç‰‡çš„å¤§å°è®¾ç½®åŠ¨ç”»çš„å€¼</span>
        <span class="token keyword">const</span> dampen <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span> <span class="token comment">// æ•°å­—è¶Šå°ï¼Œæ—‹è½¬çš„è§’åº¦è¶Šå°</span>
        <span class="token keyword">const</span> xys <span class="token operator">=</span> <span class="token punctuation">[</span>
          <span class="token operator">-</span><span class="token punctuation">(</span>y <span class="token operator">-</span> ref<span class="token punctuation">.</span>current<span class="token punctuation">.</span>clientHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> dampen<span class="token punctuation">,</span> <span class="token comment">// rotateX</span>
          <span class="token punctuation">(</span>x <span class="token operator">-</span> ref<span class="token punctuation">.</span>current<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> dampen<span class="token punctuation">,</span> <span class="token comment">// rotateY</span>
          <span class="token number">1.07</span> <span class="token comment">// Scale</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// æ›´æ–°åŠ¨ç”»çš„å€¼</span>
        <span class="token function">setAnimatedProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span> xys<span class="token operator">:</span> xys <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
      onMouseLeave<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setHovered</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è¿˜åŸxysçš„å€¼</span>
        <span class="token function">setAnimatedProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span> xys<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
      style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token comment">// å½“å¡ç‰‡è¢«hoveræ—¶æˆ‘ä»¬å¸Œæœ›å®ƒçš„å±‚çº§åœ¨å…¶ä»–å¡ç‰‡ä¹‹ä¸Š</span>
        zIndex<span class="token operator">:</span> isHovered <span class="token operator">?</span> <span class="token number">2</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token comment">// å¤„ç†csså˜åŒ–çš„å‡½æ•°</span>
        transform<span class="token operator">:</span> animatedProps<span class="token punctuation">.</span>xys<span class="token punctuation">.</span><span class="token function">interpolate</span><span class="token punctuation">(</span>
          <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> s</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">perspective(600px) rotateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">deg) rotateY(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">deg) scale(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>s<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>children<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>animated<span class="token punctuation">.</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="usehistory"><a href="#usehistory" class="header-anchor">#</a> useHistory</h4> <p>è¿™ä¸ªhookå¯ä»¥éå¸¸ç®€å•çš„å°†æ’¤é”€/é‡åšåŠŸèƒ½æ·»åŠ åˆ°ä½ çš„åº”ç”¨ä¸­ã€‚æˆ‘ä»¬çš„æ¡ˆä¾‹æ˜¯ä¸€ä¸ªç®€å•çš„ç»˜ç”»åº”ç”¨ã€‚è¿™ä¸ªä¾‹å­å°†ä¼šç”Ÿæˆä¸€ä¸ªç½‘æ ¼å—ï¼Œä½ å¯ä»¥å•å‡»ä»»ä½•ä¸€ä¸ªå—å»æ”¹å˜å®ƒçš„é¢œè‰²ï¼Œå¹¶ä¸”é€šè¿‡ä½¿ç”¨useHistory hookï¼Œæˆ‘ä»¬å¯ä»¥åœ¨canvasä¸Šæ’¤é”€ã€é‡åšæˆ–è€…æ¸…é™¤æ‰€æœ‰çš„æ›´æ”¹ã€‚<a href="https://codesandbox.io/s/32rqn6zq0p" target="_blank" rel="noopener noreferrer">åœ¨çº¿ç¤ºä¾‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚åœ¨æˆ‘ä»¬çš„hookä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨useRoduceræ¥ä»£æ›¿useStateå‚¨å­˜æ•°æ®ï¼Œè¿™äº›ä¸œè¥¿åº”è¯¥å¯¹ä»»ä½•ä½¿ç”¨è¿‡reduxçš„äººéƒ½éå¸¸çš„ç†Ÿæ‚‰ï¼ˆæŸ¥çœ‹æ›´å¤šuseReducerç›¸å…³ä¿¡æ¯å°½åœ¨<a href="https://reactjs.org/docs/hooks-reference.html#usereducer" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼‰ã€‚è¿™ä¸ªhookå¤åˆ¶äº†<a href="https://github.com/xxhomey19/use-undo" target="_blank" rel="noopener noreferrer">use-undo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>è¿™ä¸ªåº“å¹¶æœ‰ä¸€äº›ç»†å¾®çš„å˜åŒ–ã€‚å› æ­¤ä½ å¯ä»¥ç›´æ¥é€šè¿‡npmå»å®‰è£…å’Œä½¿ç”¨è¿™ä¸ªåº“ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useReducer<span class="token punctuation">,</span> useCallback <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// Usage</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> set<span class="token punctuation">,</span> undo<span class="token punctuation">,</span> redo<span class="token punctuation">,</span> clear<span class="token punctuation">,</span> canUndo<span class="token punctuation">,</span> canRedo <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useHistory</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;container&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;controls&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;title&quot;</span><span class="token operator">&gt;</span>ğŸ‘©â€ğŸ¨ Click squares to draw<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>undo<span class="token punctuation">}</span> disabled<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">!</span>canUndo<span class="token punctuation">}</span><span class="token operator">&gt;</span>
          Undo
        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>redo<span class="token punctuation">}</span> disabled<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">!</span>canRedo<span class="token punctuation">}</span><span class="token operator">&gt;</span>
          Redo
        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>clear<span class="token punctuation">}</span><span class="token operator">&gt;</span>Clear<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;grid&quot;</span><span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">blocks<span class="token punctuation">,</span> i<span class="token punctuation">,</span> len</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// ç”Ÿæˆä¸€ä¸ªç½‘æ ¼å—</span>
          <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">++</span>i <span class="token operator">&lt;=</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> index <span class="token operator">=</span> i<span class="token punctuation">;</span>
            blocks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
              <span class="token operator">&lt;</span>div
                <span class="token comment">// å¦‚æœstateä¸­çš„çŠ¶æ€ä¸ºtrueåˆ™ç»™è¿™ä¸ªå—æ·»åŠ activeç±»å</span>
                className<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'block'</span> <span class="token operator">+</span> <span class="token punctuation">(</span>state<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token string">' active'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                <span class="token comment">// æ ¹æ®ç‚¹å‡»æ”¹å˜å—çš„çŠ¶æ€å¹¶åˆå¹¶åˆ°æœ€æ–°çš„state</span>
                onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token operator">!</span>state<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                key<span class="token operator">=</span><span class="token punctuation">{</span>i<span class="token punctuation">}</span>
              <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> blocks<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">625</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// åˆå§‹åŒ–useReducerä¸­çš„state</span>
<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// å½“æˆ‘ä»¬æ¯æ¬¡æ·»åŠ æ–°stateæ—¶ï¼Œç”¨æ¥å‚¨å­˜æ›´æ–°å‰çŠ¶æ€çš„æ•°ç»„</span>
  past<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// å½“å‰çš„stateå€¼</span>
  present<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token comment">// è®©æˆ‘ä»¬å¯ä»¥ç”¨ä½¿ç”¨é‡åšåŠŸèƒ½çš„ï¼Œfutureæ•°ç»„</span>
  future<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// æ ¹æ®actionå¤„ç†stateçš„æ”¹å˜</span>
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> past<span class="token punctuation">,</span> present<span class="token punctuation">,</span> future <span class="token punctuation">}</span> <span class="token operator">=</span> state<span class="token punctuation">;</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'UNDO'</span><span class="token operator">:</span>
      <span class="token keyword">const</span> previous <span class="token operator">=</span> past<span class="token punctuation">[</span>past<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> newPast <span class="token operator">=</span> past<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> past<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        past<span class="token operator">:</span> newPast<span class="token punctuation">,</span>
        present<span class="token operator">:</span> previous<span class="token punctuation">,</span>
        future<span class="token operator">:</span> <span class="token punctuation">[</span>present<span class="token punctuation">,</span> <span class="token operator">...</span>future<span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'REDO'</span><span class="token operator">:</span>
      <span class="token keyword">const</span> next <span class="token operator">=</span> future<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> newFuture <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        past<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>past<span class="token punctuation">,</span> present<span class="token punctuation">]</span><span class="token punctuation">,</span>
        present<span class="token operator">:</span> next<span class="token punctuation">,</span>
        future<span class="token operator">:</span> newFuture
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'SET'</span><span class="token operator">:</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> newPresent <span class="token punctuation">}</span> <span class="token operator">=</span> action<span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>newPresent <span class="token operator">===</span> present<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> state<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        past<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>past<span class="token punctuation">,</span> present<span class="token punctuation">]</span><span class="token punctuation">,</span>
        present<span class="token operator">:</span> newPresent<span class="token punctuation">,</span>
        future<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'CLEAR'</span><span class="token operator">:</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> initialPresent <span class="token punctuation">}</span> <span class="token operator">=</span> action<span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>initialState<span class="token punctuation">,</span>
        present<span class="token operator">:</span> initialPresent
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Hook</span>
<span class="token keyword">const</span> <span class="token function-variable function">useHistory</span> <span class="token operator">=</span> <span class="token parameter">initialPresent</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>initialState<span class="token punctuation">,</span>
    present<span class="token operator">:</span> initialPresent
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canUndo <span class="token operator">=</span> state<span class="token punctuation">.</span>past<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> canRedo <span class="token operator">=</span> state<span class="token punctuation">.</span>future<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token comment">// è®¾ç½®æˆ‘ä»¬çš„å›è°ƒå‡½æ•°</span>
  <span class="token comment">// ä½¿ç”¨useCallbackæ¥é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“</span>

  <span class="token keyword">const</span> undo <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>canUndo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'UNDO'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>canUndo<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> redo <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>canRedo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'REDO'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>canRedo<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> set <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token parameter">newPresent</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'SET'</span><span class="token punctuation">,</span> newPresent <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    dispatch
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> clear <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'CLEAR'</span><span class="token punctuation">,</span> initialPresent <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    dispatch
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// å¦‚æœéœ€è¦ï¼ŒåŒæ ·å¯ä»¥åˆ°å¤„è¿‡å»å’Œæœªæ¥çš„state</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> state<span class="token operator">:</span> state<span class="token punctuation">.</span>present<span class="token punctuation">,</span> set<span class="token punctuation">,</span> undo<span class="token punctuation">,</span> redo<span class="token punctuation">,</span> clear<span class="token punctuation">,</span> canUndo<span class="token punctuation">,</span> canRedo <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><a href="https://github.com/xxhomey19/use-undo" target="_blank" rel="noopener noreferrer">xxhomey19/use-undo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - ä¸Šé¢æ‰€å€Ÿé‰´çš„åº“ï¼ŒåŒæ ·ä»hookä¸­è¿”å›äº†previouså’Œfutureçš„çŠ¶æ€ï¼Œä½†æ˜¯æ²¡æœ‰ä¸€ä¸ªæ¸…æ™°çš„action
<a href="https://codesandbox.io/s/yv3004lqnj" target="_blank" rel="noopener noreferrer">React useHistory hook<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - å¦ä¸€ç§useHistoryçš„å®ç°æ–¹å¼ã€‚</p></blockquote> <h4 id="usescript"><a href="#usescript" class="header-anchor">#</a> useScript</h4> <p>ä½¿ç”¨è¿™ä¸ªhookå¯ä»¥è®©ä½ éå¸¸ç®€å•çš„åŠ¨æ€åŠ è½½å¤–éƒ¨scrçš„iptå¹¶ä¸”çŸ¥é“å®ƒä»€ä¹ˆæ—¶å€™åŠ è½½å®Œæ¯•ã€‚å½“ä½ éœ€è¦ä¾èµ–ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œå¹¶ä¸”æƒ³è¦æŒ‰éœ€åŠ è½½è€Œä¸æ˜¯åœ¨æ¯ä¸€ä¸ªé¡µé¢çš„å¤´éƒ¨è¯·æ±‚æ—¶ï¼Œè¿™ä¸ªhookéå¸¸æœ‰ç”¨ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­æˆ‘ä»¬ç›´åˆ°è„šæœ¬åŠ è½½å®Œæˆå‰æ‰ä¼šè°ƒç”¨æˆ‘ä»¬åœ¨scriptä¸­å£°æ˜çš„æ–¹æ³•ã€‚å¦‚æœä½ æœ‰å…´è¶£äº†è§£ä¸€ä¸‹è¿™ä¸ªé«˜çº§ç»„ä»¶æ—¶å¦‚ä½•å®ç°çš„ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹<a href="https://github.com/sesilio/react-script-loader-hoc/blob/master/src/index.js" target="_blank" rel="noopener noreferrer">source of react-script-loader-hoc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚æˆ‘ä¸ªäººè§‰å¾—å®ƒæ¯”è¿™ä¸ªhookçš„å¯è¯»æ€§æ›´é«˜ã€‚å¦ä¸€ä¸ªä¼˜åŠ¿æ˜¯å› ä¸ºå®ƒæ›´å®¹æ˜“è°ƒç”¨ä¸€ä¸ªhookå»åŠ è½½å¤šä¸ªä¸åŒçš„scriptï¼Œè€Œä¸åƒè¿™ä¸ªé«˜é˜¶ç»„ä»¶çš„å®ç°æ–¹å¼ï¼Œæˆ‘ä»¬ä½¿ç”¨æ·»åŠ å¤šä¸ªsrcçš„å­—ç¬¦ä¸²æ¥æ”¯æŒè¿™ä¸ªåŠŸèƒ½ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// Usage</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>loaded<span class="token punctuation">,</span> error<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useScript</span><span class="token punctuation">(</span>
    <span class="token string">'https://pm28k14qlj.codesandbox.io/test-external-script.js'</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        Script loaded<span class="token operator">:</span> <span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token punctuation">{</span>loaded<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>loaded <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>error <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          Script <span class="token keyword">function</span> call response<span class="token operator">:</span> <span class="token operator">&lt;</span>b<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token constant">TEST_SCRIPT</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>b<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Hook</span>
<span class="token keyword">let</span> cachedScripts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">useScript</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// æŒç»­è·Ÿè¸ªscriptåŠ è½½å®Œæˆå’Œå¤±è´¥çš„çŠ¶æ€</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    loaded<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    error<span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœcachedScriptsæ•°ç»„ä¸­å­˜åœ¨è¿™ä¸ªsrcåˆ™ä»£è¡¨å¦ä¸€ä¸ªhookçš„å®ä¾‹åŠ è½½äº†è¿™ä¸ªscriptï¼Œæ‰€ä»¥ä¸éœ€è¦å†åŠ è½½ä¸€é</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedScripts<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          loaded<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          error<span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        cachedScripts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// åˆ›å»ºscriptæ ‡ç­¾</span>
        <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        script<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
        script<span class="token punctuation">.</span>async <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token comment">// Scriptäº‹ä»¶ç›‘å¬æ–¹æ³•</span>
        <span class="token keyword">const</span> <span class="token function-variable function">onScriptLoad</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            loaded<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            error<span class="token operator">:</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> <span class="token function-variable function">onScriptError</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// å½“å¤±è´¥æ—¶ï¼Œå°†cachedScriptsä¸­ç§»é™¤ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥é‡æ–°å°è¯•åŠ è½½</span>
          <span class="token keyword">const</span> index <span class="token operator">=</span> cachedScripts<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> cachedScripts<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          script<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            loaded<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            error<span class="token operator">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        script<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> onScriptLoad<span class="token punctuation">)</span><span class="token punctuation">;</span>
        script<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> onScriptError<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å°†scriptæ·»åŠ åˆ°æ–‡æ¡£ä¸­</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// åœ¨cleanupå›è°ƒä¸­æ¸…é™¤äº‹ä»¶ç›‘å¬</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          script<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> onScriptLoad<span class="token punctuation">)</span><span class="token punctuation">;</span>
          script<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> onScriptError<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>src<span class="token punctuation">]</span> <span class="token comment">// åªæœ‰å½“srcæ”¹å˜æ—¶æ‰ä¼šé‡æ–°è¿è¡Œ</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>state<span class="token punctuation">.</span>loaded<span class="token punctuation">,</span> state<span class="token punctuation">.</span>error<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><a href="https://github.com/sesilio/react-script-loader-hoc/blob/master/src/index.js" target="_blank" rel="noopener noreferrer">react-script-loader-hoc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - åŒæ ·é€»è¾‘çš„HOCå®ç°ï¼Œå¯ä»¥ç”¨æ¥æ¯”è¾ƒã€‚
<a href="https://github.com/palmerhq/the-platform#usescript" target="_blank" rel="noopener noreferrer">useScript from palmerhq/the-platform<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - ç±»ä¼¼çš„hookï¼Œä½†æ˜¯ä½¿ç”¨äº†React Suspenseæ¥è¿”å›ä¸€ä¸ªpromise</p></blockquote> <h4 id="usekeypress"><a href="#usekeypress" class="header-anchor">#</a> useKeyPress</h4> <p>ä½¿ç”¨è¿™ä¸ªhookå¯ä»¥è½»æ˜“çš„ç›‘æµ‹å½“ç”¨æˆ·åœ¨ä»–ä»¬çš„é”®ç›˜ä¸Šè¾“å…¥ç‰¹æ®Šçš„é”®å€¼æ—¶ã€‚è¿™ä¸ªå°çªé—¨éå¸¸çš„ç®€å•ï¼Œå¹¶ä¸”æˆ‘æƒ³ç»™ä½ ä»¬çœ‹è¿™åªéœ€è¦å¾ˆå°‘çš„ä»£ç ï¼Œä½†æˆ‘æŒ‘æˆ˜ä»»ä½•è¯»è€…çœ‹è°èƒ½åˆ›å»ºä¸€ä¸ªæ›´é«˜çº§çš„ç‰ˆæœ¬ã€‚ç›‘æµ‹å½“å¤šä¸ªé”®åŒæ—¶è¢«æŒ‰ä½ä¼šæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è¡¥å……ã€‚åŠ åˆ†é¡¹ï¼šè¿˜èƒ½æ£€æµ‹æ˜¯å¦åœ¨æŒ‰ç…§æŒ‡å®šé¡ºåºè¾“å…¥é”®å€¼ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
  <span class="token keyword">const</span> happyPress <span class="token operator">=</span> <span class="token function">useKeyPress</span><span class="token punctuation">(</span><span class="token string">'h'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> sadPress <span class="token operator">=</span> <span class="token function">useKeyPress</span><span class="token punctuation">(</span><span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> robotPress <span class="token operator">=</span> <span class="token function">useKeyPress</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> foxPress <span class="token operator">=</span> <span class="token function">useKeyPress</span><span class="token punctuation">(</span><span class="token string">'f'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>h<span class="token punctuation">,</span> s<span class="token punctuation">,</span> r<span class="token punctuation">,</span> f<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>happyPress <span class="token operator">&amp;&amp;</span> <span class="token string">'ğŸ˜Š'</span><span class="token punctuation">}</span>
        <span class="token punctuation">{</span>sadPress <span class="token operator">&amp;&amp;</span> <span class="token string">'ğŸ˜¢'</span><span class="token punctuation">}</span>
        <span class="token punctuation">{</span>robotPress <span class="token operator">&amp;&amp;</span> <span class="token string">'ğŸ¤–'</span><span class="token punctuation">}</span>
        <span class="token punctuation">{</span>foxPress <span class="token operator">&amp;&amp;</span> <span class="token string">'ğŸ¦Š'</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Hook</span>
<span class="token keyword">function</span> <span class="token function">useKeyPress</span><span class="token punctuation">(</span><span class="token parameter">targetKey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ç”¨æ¥å‚¨å­˜æŒç»­è¿½è¸ªæ˜¯å¦æœ‰é”®è¢«æŒ‰ä¸‹</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>keyPressed<span class="token punctuation">,</span> setKeyPressed<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// å¦‚æœæŒ‰ä¸‹çš„é”®å€¼æ˜¯æˆ‘ä»¬çš„ç›®æ ‡å€¼ï¼Œå°†å…¶è®¾ç½®ä¸ºtrue</span>
  <span class="token keyword">function</span> <span class="token function">downHandler</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> key <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> targetKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setKeyPressed</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// å¦‚æœæ¾å¼€çš„é”®å€¼æ˜¯æˆ‘ä»¬çš„ç›®æ ‡å€¼ï¼Œå°†å…¶è®¾ç½®ä¸ºfalse</span>
  <span class="token keyword">const</span> <span class="token function-variable function">upHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> key <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> targetKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setKeyPressed</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// æ·»åŠ äº‹ä»¶ç›‘å¬</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> downHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span> upHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åœ¨cleanupä¸­æ¸…é™¤å›è°ƒ</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> downHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
      window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span> upHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç©ºæ•°ç»„æ„å‘³ç€åªæœ‰åœ¨mountå’Œunmoutçš„æ—¶å€™æ‰ä¼šè¿è¡Œ</span>

  <span class="token keyword">return</span> keyPressed<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><a href="https://codesandbox.io/s/y3qzyr3lrz" target="_blank" rel="noopener noreferrer">useMultiKeyPress<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - è¿™ä¸ªä¾‹å­å¯ä»¥åŒæ—¶æ£€æµ‹å¤šä¸ªé”®å€¼ã€‚</p></blockquote> <h4 id="usememo"><a href="#usememo" class="header-anchor">#</a> useMemo</h4> <p>Reactå†…ç½®äº†ä¸€ä¸ªå«useMemoçš„hookï¼Œå…è®¸ä½ ç¼“å­˜å¼€é”€å¤§çš„æ–¹æ³•é¿å…å®ƒä»¬åœ¨æ¯ä¸€æ¬¡renderä¸­éƒ½è¢«è°ƒç”¨ã€‚ä½ å¯ä»¥ç®€å•çš„åªä¼ å…¥å‡½æ•°å’Œæ•°ç»„ç„¶åuseMemoå°†ä¼šåªæœ‰åœ¨å…¶ä¸­ä¸€ä¸ªè¾“å…¥æ”¹å˜çš„æƒ…å†µæ‰ä¼šé‡æ–°è®¡ç®—ã€‚ä¸‹é¢åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æœ‰ä¸€ä¸ªå«computeLetterCountçš„å¼€é”€æˆæœ¬å¤§çš„å‡½æ•°ï¼ˆå‡ºäºæ¼”ç¤ºç›®çš„ï¼Œæˆ‘ä»¬é€šè¿‡åŒ…å«	ä¸€ä¸ªå®Œå…¨ä¸å¿…è¦çš„å¤§å¾ªç¯æ¥é™ä½é€Ÿåº¦ï¼‰ã€‚å½“å‰é€‰ä¸­çš„å•è¯å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä½ ä¼šè§‚å¯Ÿåˆ°å› ä¸ºæ–°çš„å•è¯å®ƒéœ€è¦é‡æ–°è°ƒç”¨computeLetterCountæ–¹æ³•è€Œé€ æˆçš„å»¶è¿Ÿã€‚æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªè®¡æ•°å™¨ç”¨æ¥æ¯ä¸€æ¬¡æŒ‰é’®è¢«ç‚¹å‡»æ—¶å¢åŠ è®¡æ•°ã€‚å½“è®¡æ•°å™¨å¢åŠ æ—¶ï¼Œä½ ä¼šå‘ç°åœ¨ä¸¤æ¬¡æ¸²æŸ“ä¹‹å‰æ²¡æœ‰å»¶è¿Ÿã€‚è¿™æ˜¯å› ä¸ºcomputeLetterCountæ²¡æœ‰è¢«è°ƒç”¨ã€‚è¾“å…¥æ–‡å­—å¹¶æ²¡æœ‰æ”¹å˜å› æ­¤è¿”å›çš„æ˜¯ç¼“å­˜å€¼ã€‚æˆ–è®¸ä½ æƒ³çœ‹ä¸€ä¸‹<a href="https://codesandbox.io/s/jjxypyk86w" target="_blank" rel="noopener noreferrer">CodeSandbox<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ä¸Šçš„å®ä¾‹ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useMemo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// Usage</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è®¡æ•°å™¨çš„state</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// è¿½è¸ªæˆ‘ä»¬åœ¨æ•°ç»„ä¸­æƒ³è¦å±•ç¤ºçš„å½“å‰å•è¯</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>wordIndex<span class="token punctuation">,</span> setWordIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// æˆ‘ä»¬å¯ä»¥æµè§ˆå•è¯å’ŒæŸ¥çœ‹å­—æ¯ä¸ªæ•°</span>
  <span class="token keyword">const</span> words <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'hey'</span><span class="token punctuation">,</span> <span class="token string">'this'</span><span class="token punctuation">,</span> <span class="token string">'is'</span><span class="token punctuation">,</span> <span class="token string">'cool'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> word <span class="token operator">=</span> words<span class="token punctuation">[</span>wordIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// è¿”å›ä¸€ä¸ªå•è¯çš„å­—æ¯æ•°é‡</span>
  <span class="token comment">// äººä¸ºçš„ä½¿å®ƒè¿è¡Œç¼“æ…¢</span>
  <span class="token keyword">const</span> <span class="token function-variable function">computeLetterCount</span> <span class="token operator">=</span> <span class="token parameter">word</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">1000000000</span><span class="token punctuation">)</span> i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> word<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// ç¼“å­˜computeLetterCountï¼Œå½“è¾“å…¥æ•°ç»„çš„å€¼å’Œä¸Šä¸€æ¬¡è¿è¡Œä¸€æ ·çš„è¯ï¼Œå°±ä¼šè¿”å›ç¼“å­˜çš„å€¼</span>
  <span class="token keyword">const</span> letterCount <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">computeLetterCount</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>word<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// è¿™ä¸ªæ–¹æ³•ä¼šæ˜¯æˆ‘ä»¬å¢åŠ è®¡æ•°å˜å¾—å»¶è¿Ÿï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¾—ä¸ç­‰å¼€é”€å·¨å¤§çš„æ–¹æ³•é‡æ–°è¿è¡Œã€‚</span>
  <span class="token comment">//const letterCount = computeLetterCount(word);</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> padding<span class="token operator">:</span> <span class="token string">'15px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Compute number <span class="token keyword">of</span> <span class="token function">letters</span> <span class="token punctuation">(</span>slow ğŸŒ<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token string">&quot;{word}&quot;</span> has <span class="token punctuation">{</span>letterCount<span class="token punctuation">}</span> letters<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button
        onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> next <span class="token operator">=</span> wordIndex <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">===</span> words<span class="token punctuation">.</span>length <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> wordIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
          <span class="token function">setWordIndex</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">&gt;</span>
        Next word
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Increment a <span class="token function">counter</span> <span class="token punctuation">(</span>fast âš¡ï¸<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Counter<span class="token operator">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>Increment<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="usedebounce"><a href="#usedebounce" class="header-anchor">#</a> useDebounce</h4> <p>è¿™ä¸ªhookå…è®¸å¯¹ä»»ä½•å¿«é€Ÿæ”¹å˜çš„å€¼å»æŠ–åŠ¨ã€‚å»æŠ–åŠ¨çš„å€¼åªæœ‰å½“æœ€æ–°çš„å€¼åœ¨æŒ‡å®šæ—¶é—´é—´éš”å†…useDebounce hookæ²¡æœ‰è¢«è°ƒç”¨çš„æƒ…å†µä¸‹æ‰ä¼šæ”¹å˜ã€‚æ¯”å¦‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­æˆ‘ä»¬ç”¨æ¥å’ŒuseEffecté…åˆä½¿ç”¨ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°ç¡®ä¿ç±»ä¼¼APIè°ƒç”¨è¿™æ ·çš„æ˜‚è´µæ“ä½œä¸ä¼šè¢«é¢‘ç¹è°ƒç”¨ã€‚ä¸‹é¢çš„å®ä¾‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ¼«å¨æ¼«ç”»APIè¿›è¡Œæœç´¢ï¼Œå¹¶ä¸”é€šè¿‡ä½¿ç”¨useDebounceé˜²æ­¢APIæ¯æ¬¡æŒ‰é”®éƒ½è¢«è°ƒç”¨è€Œå¯¼è‡´ä½ è¢«æ¥å£å±è”½ã€‚<a href="https://codesandbox.io/s/711r1zmq50" target="_blank" rel="noopener noreferrer">åœ¨çº¿å®ä¾‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ï¼Œ hookä»£ç å’Œçµæ„Ÿæ¥è‡ª<a href="https://github.com/xnimorz/use-debounce" target="_blank" rel="noopener noreferrer">https://github.com/xnimorz/use-debounce<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// Usage</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// æœç´¢è¯</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>searchTerm<span class="token punctuation">,</span> setSearchTerm<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// APIæœç´¢ç»“æœ</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>results<span class="token punctuation">,</span> setResults<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// æœç´¢çŠ¶æ€ (æ˜¯å¦æœ‰æ­£åœ¨ç­‰å¾…çš„è¯·æ±‚)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isSearching<span class="token punctuation">,</span> setIsSearching<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å¯¹æ”¹å˜æœç´¢è¯å»æŠ–åŠ¨ï¼Œåªæœ‰å½“æœç´¢è¯500æ¯«ç§’å†…æ²¡æœ‰å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰ä¼šè¿”å›æœ€æ–°çš„å€¼</span>
  <span class="token comment">// ç›®æ ‡å°±æ˜¯åªæœ‰å½“ç”¨æˆ·åœæ­¢è¾“å…¥æ—¶æ‰ä¼šè°ƒç”¨APIï¼Œé˜²æ­¢æˆ‘ä»¬å¤ªè¿‡è¿…é€Ÿé¢‘ç¹çš„è°ƒç”¨API</span>
  <span class="token keyword">const</span> debouncedSearchTerm <span class="token operator">=</span> <span class="token function">useDebounce</span><span class="token punctuation">(</span>searchTerm<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Effect for API call </span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>debouncedSearchTerm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setIsSearching</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">searchCharacters</span><span class="token punctuation">(</span>debouncedSearchTerm<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">results</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">setIsSearching</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setResults</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">setResults</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>debouncedSearchTerm<span class="token punctuation">]</span> <span class="token comment">// åªæœ‰å½“å»æŠ–åŠ¨åçš„æœç´¢è¯æ”¹å˜æ—¶æ‰ä¼šè°ƒç”¨</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input
        placeholder<span class="token operator">=</span><span class="token string">&quot;Search Marvel Comics&quot;</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">setSearchTerm</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
  
      <span class="token punctuation">{</span>isSearching <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Searching <span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span>

      <span class="token punctuation">{</span>results<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div key<span class="token operator">=</span><span class="token punctuation">{</span>result<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>h4<span class="token operator">&gt;</span><span class="token punctuation">{</span>result<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>img
            src<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">.</span>thumbnail<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/portrait_incredible.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
              result<span class="token punctuation">.</span>thumbnail<span class="token punctuation">.</span>extension
            <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// API search function</span>
<span class="token keyword">function</span> <span class="token function">searchCharacters</span><span class="token punctuation">(</span><span class="token parameter">search</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> apiKey <span class="token operator">=</span> <span class="token string">'f9dfb1e8d466d36c27850bedd2047687'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://gateway.marvel.com/v1/public/comics?apikey=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>apiKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;titleStartsWith=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>search<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      method<span class="token operator">:</span> <span class="token string">'GET'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>  
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span>data<span class="token punctuation">.</span>results<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
       
<span class="token comment">// Hook</span>
<span class="token keyword">function</span> <span class="token function">useDebounce</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å­˜å‚¨å»æŠ–åŠ¨åçš„å€¼</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>debouncedValue<span class="token punctuation">,</span> setDebouncedValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// åœ¨å»¶è¿Ÿdelayä¹‹åæ›´æ–°å»æŠ–åŠ¨åçš„å€¼</span>
      <span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setDebouncedValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// å¦‚æœå€¼æ”¹å˜äº†å–æ¶ˆtimeout (åŒæ ·åœ¨delayæ”¹å˜æˆ–è€…unmountæ—¶ç”Ÿæ•ˆ)</span>
      <span class="token comment">// è¿™å°±æ˜¯æˆ‘ä»¬é€šè¿‡å»¶è¿Ÿé—´éš”å†…å€¼æ²¡æœ‰è¢«æ”¹å˜æ¥è¾¾åˆ°é˜²æ­¢å€¼å»æŠ–åŠ¨ æ¸…ç©ºtimeoutå¹¶ä¸”é‡æ–°è¿è¡Œ</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>value<span class="token punctuation">,</span> delay<span class="token punctuation">]</span> <span class="token comment">// åªæœ‰å½“æœç´¢å€¼æˆ–è€…delayå€¼å‘ç”Ÿæ”¹å˜æ—¶æ‰ä¼šé‡æ–°è°ƒç”¨</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> debouncedValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="useonscreen"><a href="#useonscreen" class="header-anchor">#</a> useOnScreen</h4> <p>è¿™ä¸ªhookå…è®¸ä½ è½»æ˜“çš„æ£€æµ‹ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨å±å¹•ä¸Šå¯è§ï¼Œä»¥åŠæŒ‡å®šæœ‰å¤šå°‘å…ƒç´ åº”è¯¥è¢«æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚å½“ç”¨æˆ·æ»šåŠ¨åˆ°æŸä¸ªç‰¹å®šåŒºåŸŸï¼Œéå¸¸é€‚åˆæ‡’åŠ è½½å›¾ç‰‡æˆ–è€…è§¦å‘åŠ¨ç”»ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// Usage</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ç”¨æ¥å‚¨å­˜æˆ‘ä»¬æƒ³è¦æ£€æµ‹æ˜¯å¦åœ¨å±å¹•ä¸­çš„å…ƒç´ </span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// è°ƒç”¨hookå¹¶ä¼ å…¥refå’Œroot margin</span>
  <span class="token comment">// åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰å½“å…ƒç´ å¤šå¤§äº300pxçš„å…ƒç´ æ‰ä¼šåœ¨å±å¹•ä¸Šæ˜¾ç¤º</span>
  <span class="token keyword">const</span> onScreen <span class="token operator">=</span> <span class="token function">useOnScreen</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token string">'-300px'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> height<span class="token operator">:</span> <span class="token string">'100vh'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Scroll down to next section ğŸ‘‡<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div
        ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span>
        style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
          height<span class="token operator">:</span> <span class="token string">'100vh'</span><span class="token punctuation">,</span>
          backgroundColor<span class="token operator">:</span> onScreen <span class="token operator">?</span> <span class="token string">'#23cebd'</span> <span class="token operator">:</span> <span class="token string">'#efefef'</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>onScreen <span class="token operator">?</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hey <span class="token constant">I</span>'m on the screen<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">&quot;https://i.giphy.com/media/ASd0Ukj0y3qMM/giphy.gif&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Scroll down <span class="token number">300</span>px <span class="token keyword">from</span> the top <span class="token keyword">of</span> <span class="token keyword">this</span> section ğŸ‘‡<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Hook</span>
<span class="token keyword">function</span> <span class="token function">useOnScreen</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> rootMargin <span class="token operator">=</span> <span class="token string">'0px'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å‚¨å­˜å…ƒç´ æ˜¯å¦å¯è§çš„çŠ¶æ€</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isIntersecting<span class="token punctuation">,</span> setIntersecting<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>entry<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// å½“observerå›è°ƒè§¦å‘æ˜¯æ›´æ–°çŠ¶æ€</span>
        <span class="token function">setIntersecting</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        rootMargin
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ref<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>ref<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      observer<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>ref<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç©ºæ•°ç»„ç¡®ä¿åªä¼šåœ¨mountå’Œunmountæ‰§è¡Œ</span>

  <span class="token keyword">return</span> isIntersecting<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><a href="https://thebuilder.github.io/react-intersection-observer/?path=/story/useinview-hook--taller-then-viewport-with-threshold-100" target="_blank" rel="noopener noreferrer">react-intersection-observer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - ä¸€ä¸ªæ›´åŠ å¥å£®å’Œå¯é…ç½®çš„å®ç°ã€‚</p></blockquote> <h4 id="useprevious"><a href="#useprevious" class="header-anchor">#</a> usePrevious</h4> <p>ä¸€ä¸ªç»å¸¸ä¼šå‡ºç°çš„é—®é¢˜æ˜¯ï¼Œå½“ä½¿ç”¨hookçš„æ—¶å€™æˆ‘ä»¬å¦‚ä½•è·å–propså’Œstateä¹‹å‰çš„å€¼ã€‚åœ¨Reactçš„classç»„ä»¶å†…æˆ‘ä»¬æœ‰componentDidUpdateæ–¹æ³•ç”¨æ¥å‚æ•°çš„å½¢å¼æ¥æ¥æ”¶ä¹‹å‰çš„propså’Œstateï¼Œæˆ–è€…ä½ å®¢æˆ·æ›´æ–°ä¸€ä¸ªå®ä¾‹å˜é‡ï¼ˆthis.previous = valueï¼‰å¹¶åœ¨ç¨åå¼•ç”¨å®ƒä»¥è·å¾—ä¹‹å‰çš„å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬å¦‚ä½•èƒ½åœ¨æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æˆ–è€…å®ä¾‹å­˜å‚¨å€¼çš„å‡½æ•°ç»„ä»¶ä¸­åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼ŸHookæ¥æ•‘ç«ã€‚æˆ‘ä»¬å¯ä»¥åˆ›é€ ä¸€ä¸ªå®šåˆ¶çš„hookï¼Œä½¿ç”¨useRef hookåœ¨å†…éƒ¨å­˜å‚¨ä¹‹å‰çš„å€¼ã€‚æŸ¥çœ‹ä¸‹é¢çš„ä¾‹å­å’Œè¡Œå†…æ³¨é‡Šã€‚æˆ–è€…ç›´æ¥æŸ¥çœ‹<a href="https://reactjs.org/docs/hooks-faq.html#how-to-get-the-previous-props-or-state" target="_blank" rel="noopener noreferrer">å®˜æ–¹ä¾‹å­<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// Usage</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// è·å–æ›´æ–°å‰çš„å€¼ (åœ¨ä¸Šä¸€æ¬¡renderä¸­ä¼ è¿›hook)</span>
  <span class="token keyword">const</span> prevCount <span class="token operator">=</span> <span class="token function">usePrevious</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// åŒæ—¶å±•ç¤ºå½“å‰å€¼å’Œæ›´æ–°å‰å€¼</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Now<span class="token operator">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token punctuation">,</span> before<span class="token operator">:</span> <span class="token punctuation">{</span>prevCount<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>Increment<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Hook</span>
<span class="token keyword">function</span> <span class="token function">usePrevious</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// refå¯¹è±¡æ˜¯ä¸€ä¸ªé€šç”¨å®¹å™¨å…¶currentå±æ€§ä¸ºå¯å˜çš„ï¼Œå¹¶ä¸”å¯ä»¥å®¹çº³ä»»ä½•å€¼ï¼Œç±»ä¼¼ä¸ä¸€ä¸ªç±»ä¸Šçš„å®ä¾‹å±æ€§ã€‚</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Store current value in ref</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ref<span class="token punctuation">.</span>current <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åªæœ‰å½“å€¼æ”¹å˜æ—¶é‡æ–°è¿è¡Œ</span>
  
  <span class="token comment">// è¿”å›æ›´æ–°å‰çš„å€¼ (å‘ç”Ÿåœ¨useEffectæ›´æ–°ä¹‹å‰)</span>
  <span class="token keyword">return</span> ref<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="useonclickoutside"><a href="#useonclickoutside" class="header-anchor">#</a> useOnClickOutside</h4> <p>è¿™ä¸ªhookå…è®¸ä½ ç›‘æµ‹æ˜¯å¦åœ¨ä¸€ä¸ªç‰¹å®šå…ƒç´ å¤–ç‚¹å‡»ã€‚åœ¨æ¥ä¸‹æ¥çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒç›‘æµ‹åœ¨modalæ¡†ä»¥å¤–ä»»ä½•å…ƒç´ è¢«ç‚¹å‡»æ—¶ï¼Œå»å…³é—­modalæ¡†ã€‚é€šè¿‡æŠ½è±¡è¿™ä¸ªé€»è¾‘åˆ°ä¸€ä¸ªhookä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“å°†å®ƒä½¿ç”¨åœ¨éœ€è¦è¿™ç§ç±»ä¼¼åŠŸèƒ½çš„ç»„ä»¶ä¸­ï¼ˆä¸‹æ‹‰èœå•ã€æç¤ºç­‰ï¼‰</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// Usage</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆ›å»ºä¸€ä¸ªrefï¼Œå‚¨å­˜æˆ‘ä»¬è¦ç›‘æµ‹å¤–éƒ¨ç‚¹å‡»çš„å…ƒç´ </span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// modalæ¡†çš„é€»è¾‘</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isModalOpen<span class="token punctuation">,</span> setModalOpen<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// è°ƒç”¨hookï¼Œå¹¶ä¼ å…¥refå’Œå¤–éƒ¨ç‚¹å‡»æ—¶è¦è§¦å‘çš„å‡½æ•°</span>
  <span class="token function">useOnClickOutside</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setModalOpen</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>isModalOpen <span class="token operator">?</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token operator">&gt;</span>
          ğŸ‘‹ Hey<span class="token punctuation">,</span> <span class="token constant">I</span>'m a modal<span class="token punctuation">.</span> Click anywhere outside <span class="token keyword">of</span> me to close<span class="token punctuation">.</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setModalOpen</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>Open Modal<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Hook</span>
<span class="token keyword">function</span> <span class="token function">useOnClickOutside</span><span class="token punctuation">(</span><span class="token parameter">ref<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token function-variable function">listener</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// å…ƒç´ å†…ç‚¹å‡»ä¸åšä»»ä½•äº‹</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ref<span class="token punctuation">.</span>current <span class="token operator">||</span> ref<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">handler</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousedown'</span><span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchstart'</span><span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mousedown'</span><span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'touchstart'</span><span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// å°†refå’Œå¤„ç†å‡½æ•°æ·»åŠ åˆ°effectçš„ä¾èµ–æ•°ç»„ä¸­</span>
    <span class="token comment">// å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå› ä¸ºåœ¨æ¯ä¸€æ¬¡renderä¸­è¢«ä¼ å…¥çš„å¤„ç†æ–¹æ³•æ˜¯ä¸€ä¸ªæ–°å‡½æ•°ï¼Œè¿™å°†ä¼šå¯¼è‡´effectçš„callbackå’Œcleanupæ¯æ¬¡renderæ—¶è¢«1è°ƒç”¨ã€‚</span>
    <span class="token comment">// è¿™ä¸ªé—®é¢˜ä¹Ÿä¸å¤§ï¼Œä½ å¯ä»¥å°†å¤„ç†å‡½æ•°é€šè¿‡useCallbackåŒ…è£¹èµ·æ¥ç„¶åå†ä¼ å…¥hookä¸­ã€‚</span>
    <span class="token punctuation">[</span>ref<span class="token punctuation">,</span> handler<span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>[Andarist/use-onclickoutside] - ç±»ä¼¼é€»è¾‘çš„åº“ã€‚å¦‚æœä½ æƒ³è¦ä»github/npmä¸Šæ‹‰å–ä¸€äº›ä¸œè¥¿ï¼Œè¿™ä¸ªåº“æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p></blockquote> <h4 id="useanimation"><a href="#useanimation" class="header-anchor">#</a> useAnimation</h4> <p>è¿™ä¸ªhookå…è®¸ä½ é€šè¿‡ä¸€ä¸ªç¼“åŠ¨å‡½æ•°å»å¹³æ»‘çš„åŠ¨ç”»ä»»æ„å€¼ï¼ˆlinear elasticï¼‰ã€‚åœ¨ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨useAnimation hookä¸‰æ¬¡å»è®©ä¸‰ä¸ªä¸åŒçš„å°çƒåœ¨ä¸åŒçš„é—´éš”æ—¶é—´å®ŒæˆåŠ¨ç”»ã€‚ä½œä¸ºé¢å¤–çš„ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä¹Ÿå±•ç¤ºäº†å¦‚ä½•ç»„åˆhookæ˜¯éå¸¸ç®€å•çš„ã€‚æˆ‘ä»¬çš„useAnimation hookä¸å®é™…ä½¿ç”¨useStateæˆ–è€…useEffectæœ¬èº«ï¼Œè€Œæ˜¯ä½¿ç”¨useAnimationTimer hookå°†å…¶åŒ…è£¹èµ·æ¥ã€‚å°†è®¡æ—¶å™¨ç›¸å…³é€»è¾‘ä»hookä¸­æŠ½ç¦»å‡ºæ¥ï¼Œè®©æˆ‘ä»¬çš„ä»£ç å¯è¯»æ€§æ›´é«˜å¹¶ä¸”å¯ä»¥åœ¨å…¶ä»–ç¯èŠ‚ä½¿ç”¨è®¡æ—¶å™¨é€»è¾‘ã€‚<a href="https://codesandbox.io/s/qxnmn1n45q" target="_blank" rel="noopener noreferrer">åœ¨çº¿å®ä¾‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// Usage</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åœ¨ä¸åŒçš„å¯åŠ¨å»¶è¿Ÿå»å¤šæ¬¡è°ƒç”¨hookä»¥è·å¾—ä¸åŒçš„åŠ¨ç”»å€¼</span>
  <span class="token keyword">const</span> animation1 <span class="token operator">=</span> <span class="token function">useAnimation</span><span class="token punctuation">(</span><span class="token string">'elastic'</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> animation2 <span class="token operator">=</span> <span class="token function">useAnimation</span><span class="token punctuation">(</span><span class="token string">'elastic'</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> animation3 <span class="token operator">=</span> <span class="token function">useAnimation</span><span class="token punctuation">(</span><span class="token string">'elastic'</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> display<span class="token operator">:</span> <span class="token string">'flex'</span><span class="token punctuation">,</span> justifyContent<span class="token operator">:</span> <span class="token string">'center'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Ball
        innerStyle<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
          marginTop<span class="token operator">:</span> animation1 <span class="token operator">*</span> <span class="token number">200</span> <span class="token operator">-</span> <span class="token number">100</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>Ball
        innerStyle<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
          marginTop<span class="token operator">:</span> animation2 <span class="token operator">*</span> <span class="token number">200</span> <span class="token operator">-</span> <span class="token number">100</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>Ball
        innerStyle<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
          marginTop<span class="token operator">:</span> animation3 <span class="token operator">*</span> <span class="token number">200</span> <span class="token operator">-</span> <span class="token number">100</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">Ball</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> innerStyle <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div
    style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
      width<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      height<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      marginRight<span class="token operator">:</span> <span class="token string">'40px'</span><span class="token punctuation">,</span>
      borderRadius<span class="token operator">:</span> <span class="token string">'50px'</span><span class="token punctuation">,</span>
      backgroundColor<span class="token operator">:</span> <span class="token string">'#4dd5fa'</span><span class="token punctuation">,</span>
      <span class="token operator">...</span>innerStyle
    <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Hook </span>
<span class="token keyword">function</span> <span class="token function">useAnimation</span><span class="token punctuation">(</span>
  easingName <span class="token operator">=</span> <span class="token string">'linear'</span><span class="token punctuation">,</span>
  duration <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span>
  delay <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// useAnimationTimeråœ¨æˆ‘ä»¬ç»™å®šçš„æ—¶é—´å†…åœ¨æ¯ä¸€å¸§è°ƒç”¨useStateï¼Œå°½å¯èƒ½çš„ä½¿åŠ¨ç”»æ›´åŠ çš„æµç•…</span>
  <span class="token keyword">const</span> elapsed <span class="token operator">=</span> <span class="token function">useAnimationTimer</span><span class="token punctuation">(</span>duration<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// åœ¨0-1çš„æ—¶é—´èŒƒå›´å†…æŒ‡å®šæŒç»­æ—¶é—´çš„æ€»é‡</span>
  <span class="token keyword">const</span> n <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> elapsed <span class="token operator">/</span> duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// æ ¹æ®æˆ‘ä»¬æŒ‡å®šçš„ç¼“åŠ¨å‡½æ•°è¿”å›ä¿®æ”¹åçš„å€¼</span>
  <span class="token keyword">return</span> easing<span class="token punctuation">[</span>easingName<span class="token punctuation">]</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä¸€äº›ç¼“åŠ¨å‡½æ•°çš„åœ°å€:</span>
<span class="token comment">// https://github.com/streamich/ts-easing/blob/master/src/index.ts</span>
<span class="token comment">// åœ¨è¿™é‡Œç¡¬ç¼–ç æˆ–è€…å¼•å…¥ä¾èµ–</span>
<span class="token keyword">const</span> easing <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">linear</span><span class="token operator">:</span> <span class="token parameter">n</span> <span class="token operator">=&gt;</span> n<span class="token punctuation">,</span>
  <span class="token function-variable function">elastic</span><span class="token operator">:</span> <span class="token parameter">n</span> <span class="token operator">=&gt;</span>
    n <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">33</span> <span class="token operator">*</span> n <span class="token operator">*</span> n <span class="token operator">*</span> n <span class="token operator">*</span> n <span class="token operator">-</span> <span class="token number">106</span> <span class="token operator">*</span> n <span class="token operator">*</span> n <span class="token operator">*</span> n <span class="token operator">+</span> <span class="token number">126</span> <span class="token operator">*</span> n <span class="token operator">*</span> n <span class="token operator">-</span> <span class="token number">67</span> <span class="token operator">*</span> n <span class="token operator">+</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">inExpo</span><span class="token operator">:</span> <span class="token parameter">n</span> <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">useAnimationTimer</span><span class="token punctuation">(</span><span class="token parameter">duration <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span> delay <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>elapsed<span class="token punctuation">,</span> setTime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> animationFrame<span class="token punctuation">,</span> timerStop<span class="token punctuation">,</span> start<span class="token punctuation">;</span>

      <span class="token comment">// åœ¨æ¯ä¸€å¸§åŠ¨ç”»æ‰€è¦æ‰§è¡Œçš„å‡½æ•°</span>
      <span class="token keyword">function</span> <span class="token function">onFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTime</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// åœ¨ä¸‹ä¸€ä¸ªå¸§ä¸Šè°ƒç”¨onFrame()</span>
      <span class="token keyword">function</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        animationFrame <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>onFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">function</span> <span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è®¾ç½®ä¸€ä¸ªtimeoutå½“æŒç»­æ—¶é—´è¶…è¿‡æ—¶åœæ­¢</span>
        timerStop <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>animationFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setTime</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> duration<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å¼€å§‹å¾ªç¯</span>
        start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// åœ¨æŒ‡å®šçš„å»¶è¿Ÿåæ‰§è¡Œ(defaults to 0)</span>
      <span class="token keyword">const</span> timerDelay <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>onStart<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Clean things up</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timerStop<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timerDelay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>animationFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>duration<span class="token punctuation">,</span> delay<span class="token punctuation">]</span> <span class="token comment">// åªæœ‰å½“æŒç»­æ—¶é—´å’Œå»¶è¿Ÿæ”¹å˜æ—¶é‡æ–°è¿è¡Œ</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> elapsed<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="usewindowsize"><a href="#usewindowsize" class="header-anchor">#</a> useWindowSize</h4> <p>ä¸€ä¸ªçœŸæ­£å¸¸è§çš„éœ€æ±‚æ˜¯è·å–æµè§ˆå™¨å½“å‰çª—å£çš„å°ºå¯¸ã€‚è¿™ä¸ªhookè¿”å›åŒ…å«å®½é«˜çš„å¯¹è±¡ã€‚å¦‚æœåœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ(æ²¡æœ‰windowå¯¹è±¡)ï¼Œåˆ™å®½åº¦å’Œé«˜åº¦çš„å€¼å°†æœªå®šä¹‰ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// Usage</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> size <span class="token operator">=</span> <span class="token function">useWindowSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>size<span class="token punctuation">.</span>width<span class="token punctuation">}</span>px <span class="token operator">/</span> <span class="token punctuation">{</span>size<span class="token punctuation">.</span>height<span class="token punctuation">}</span>px
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Hook</span>
<span class="token keyword">function</span> <span class="token function">useWindowSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isClient <span class="token operator">=</span> <span class="token keyword">typeof</span> window <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      width<span class="token operator">:</span> isClient <span class="token operator">?</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
      height<span class="token operator">:</span> isClient <span class="token operator">?</span> window<span class="token punctuation">.</span>innerHeight <span class="token operator">:</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>windowSize<span class="token punctuation">,</span> setWindowSize<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>getSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isClient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">function</span> <span class="token function">handleResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setWindowSize</span><span class="token punctuation">(</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç©ºæ•°ç»„ä¿è¯effectåªä¼šåœ¨mountå’Œunmountæ‰§è¡Œ</span>

  <span class="token keyword">return</span> windowSize<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="usehover"><a href="#usehover" class="header-anchor">#</a> useHover</h4> <p>ç›‘æµ‹ä¸€ä¸ªé¼ æ ‡æ˜¯å¦ç§»åŠ¨åˆ°æŸä¸ªå…ƒç´ ä¸Šã€‚è¿™ä¸ªhookè¿”å›ä¸€ä¸ªrefå’Œä¸€ä¸ªå¸ƒå°”å€¼ï¼Œæ”¹å€¼è¡¨ç¤ºå½“å‰å…·æœ‰è¯¥refçš„å…ƒç´ æ˜¯å¦è¢«hoverã€‚å› æ­¤åªéœ€è¦å°†è¿”å›çš„refæ·»åŠ åˆ°ä½ æƒ³è¦ç›‘å¬hoverçŠ¶æ€çš„ä»»ä½•å…ƒç´ ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// Usage</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>hoverRef<span class="token punctuation">,</span> isHovered<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useHover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>hoverRef<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>isHovered <span class="token operator">?</span> <span class="token string">'ğŸ˜'</span> <span class="token operator">:</span> <span class="token string">'â˜¹ï¸'</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Hook</span>
<span class="token keyword">function</span> <span class="token function">useHover</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">handleMouseOver</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handleMouseOut</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> node <span class="token operator">=</span> ref<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseover'</span><span class="token punctuation">,</span> handleMouseOver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseout'</span><span class="token punctuation">,</span> handleMouseOut<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          node<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseover'</span><span class="token punctuation">,</span> handleMouseOver<span class="token punctuation">)</span><span class="token punctuation">;</span>
          node<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseout'</span><span class="token punctuation">,</span> handleMouseOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>ref<span class="token punctuation">.</span>current<span class="token punctuation">]</span> <span class="token comment">// åªæœ‰å½“refæ”¹å˜æ—¶æ‰ä¼šé‡æ–°è°ƒç”¨</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>ref<span class="token punctuation">,</span> value<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="uselocalstorage"><a href="#uselocalstorage" class="header-anchor">#</a> useLocalStorage</h4> <p>å°†stateä¸­çš„æ•°æ®åŒæ­¥åˆ°localstorageï¼Œä»¥ä¾¿é¡µé¢åˆ·æ–°çš„æ—¶å€™ä¿å­˜çŠ¶æ€ã€‚ä½¿ç”¨æ–¹æ³•å’ŒuseStateç±»ä¼¼ï¼Œæˆ‘ä»¬åªè¦ä¼ å…¥ä¸€ä¸ªlocalstorageçš„å€¼ï¼Œä»¥ä¾¿åœ¨é¡µé¢åŠ è½½æ—¶é»˜è®¤ä½¿ç”¨è¯¥å€¼ï¼Œè€Œä¸æ˜¯æŒ‡å®šçš„åˆå§‹å€¼ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// Usage</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä¸useStateç›¸ä¼¼ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯localstorageä¸­çš„keyå€¼</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useLocalStorage</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Bob'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input
        type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span>
        placeholder<span class="token operator">=</span><span class="token string">&quot;Enter your name&quot;</span>
        value<span class="token operator">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span>
        onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">setName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Hook</span>
<span class="token keyword">function</span> <span class="token function">useLocalStorage</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> initialValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// State to store our value</span>
  <span class="token comment">// å°†åˆå§‹çŠ¶æ€ä¼ ç»™useStateï¼Œè¿™æ ·é€»è¾‘åªä¼šæ‰§è¡Œä¸€æ¬¡</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>storedValue<span class="token punctuation">,</span> setStoredValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// é€šè¿‡keyå€¼ä»localstorageä¸­è·å–å€¼</span>
      <span class="token keyword">const</span> item <span class="token operator">=</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// å¦‚æœæ²¡æœ‰è¿”å›åˆå§‹å€¼åˆ™è§£æå‚¨å­˜çš„json</span>
      <span class="token keyword">return</span> item <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">:</span> initialValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœæŠ¥é”™äº†ä¾æ—§è¿”å›åˆå§‹å€¼</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> initialValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// è¿”å›useStateçš„setterå‡½æ•°çš„åŒ…è£…ç‰ˆæœ¬ï¼Œè¯¥å‡½æ•°å°†æ–°çš„å€¼ä¿å­˜åˆ°localstorageä¸­</span>
  <span class="token keyword">const</span> <span class="token function-variable function">setValue</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// å…è®¸å€¼æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±æœ‰äº†å’ŒuseStateä¸€æ ·çš„api</span>
      <span class="token keyword">const</span> valueToStore <span class="token operator">=</span>
        value <span class="token keyword">instanceof</span> <span class="token class-name">Function</span> <span class="token operator">?</span> <span class="token function">value</span><span class="token punctuation">(</span>storedValue<span class="token punctuation">)</span> <span class="token operator">:</span> value<span class="token punctuation">;</span>
      <span class="token comment">// ä¿å­˜state</span>
      <span class="token function">setStoredValue</span><span class="token punctuation">(</span>valueToStore<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// ä¿å­˜åˆ°localStorage</span>
      window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>valueToStore<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ›´é«˜çº§å®ç°çš„å¤„ç†å°†ä¼šå¤„ç†é”™è¯¯çš„æƒ…å†µ</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>storedValue<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><a href="https://github.com/donavon/use-persisted-state" target="_blank" rel="noopener noreferrer">use-persisted-state<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - ä¸€ä¸ªæ›´é«˜çº§çš„å®ç°ï¼Œå¯ä»¥åœ¨ä¸åŒtabå’Œæµè§ˆå™¨çª—å£ä¹‹é—´åŒæ­¥ã€‚</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/js/jsä»£ç è§„èŒƒ.html" class="prev">
        Airbnb JavaScript Style Guide()
      </a></span> <span class="next"><a href="/js/ä½¿ç”¨Nodejså’ŒPuppeteerä»HTMLä¸­å¯¼å‡ºPDF.html">
        ä½¿ç”¨Nodejså’ŒPuppeteerä»HTMLä¸­å¯¼å‡ºPDF
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5d71a1c6.js" defer></script><script src="/assets/js/2.c183a324.js" defer></script><script src="/assets/js/20.90ed0136.js" defer></script>
  </body>
</html>
